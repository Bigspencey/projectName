var payment=(function(window,$,undefined){var mopsLength=clientSideData.MOP_SETTINGS.MOP_LIST.length;var mockForms=[];var installmentsOffered=false;var installmentsCallMade=false;var lock;var noZipAddressMatched=false;var maxCEPLookupFailed={TAMCreditCard:0,CreditCard:0,DoubleCreditCard:0};var maxZipAddressSearchFailed={TAMCreditCard:0,CreditCard:0,DoubleCreditCard:0};var currentCEPMop="";$.wdk.errorPanel.prototype.default_options={avoidAddingTooltip:true,avoidAddingToPanel:false};for(var i=0;i<mopsLength;i++){mockForms[i]=wdk.form("MOP_FORM_"+i,{errorPanel:$("#pageError_"+i),check:function(){$.unblockUI();if(clientSideData.PAGE_CODE!="FSRS"||(clientSideData.PAGE_CODE=="FSRS"&&typeof(fsrsController)!=="undefined"&&fsrsController.getPaymentRequired())){if($(this).parents(".mop_DoubleCreditCard").length>0){if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(false,1);setDisabled(false,2);}for(var i=1;i<3;i++){if(i==2){setTimeout(function(){$("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_1']").selectBox("refresh");$("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_2']").selectBox("refresh");},1);}if(this.input("dcc_cpfBirthDay_1").length>0){if(!$("#security_adress",$(this)).prop("checked")&&i==2){this.input("PAYMENT_CC_DATE_OF_BIRTH_"+i).value(this.input("PAYMENT_CC_DATE_OF_BIRTH_1").value());}else{if(i==1){this.input("PAYMENT_CC_CUSTOMER_NUMBER_"+i).check(checkCpf,clientMessages[clientSideData.PAGE_CODE+".error.Docid.CpfNumberWrongFormat"+i],{"avoidAddingToPanel":false});}if($("#security_adress",$(this)).prop("checked")&&i==2){this.input("PAYMENT_CC_FULL_HOLDER_NAME_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.Docid.NeedToEnterCpfName"+i]);this.input("PAYMENT_CC_FULL_HOLDER_NAME_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.Docid.WrongEnterCpfName"+i],{},clientMessages["GLBL.regexp.billingInformation.cpfName"]);this.input("PAYMENT_CC_CUSTOMER_NUMBER_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.Docid.NeedToEnterCpf"+i]);this.input("PAYMENT_CC_CUSTOMER_NUMBER_"+i).check(checkCpf,clientMessages[clientSideData.PAGE_CODE+".error.Docid.CpfNumberWrongFormat"+i],{"avoidAddingToPanel":false});}var dateCheck=checkCpfDOB(this.input("dcc_cpfBirthDay_"+i).value(),this.input("dcc_cpfBirthMonth_"+i).value(),this.input("dcc_cpfBirthYear_"+i).value());if(!dateCheck){this.input("dcc_cpfBirthDay_"+i).addClass("em").selectBox("destroy").selectBox();this.input("dcc_cpfBirthMonth_"+i).addClass("em").selectBox("destroy").selectBox();this.input("dcc_cpfBirthYear_"+i).addClass("em").selectBox("destroy").selectBox();this.wdkform("option","errorPanel").errorPanel("addError",this.input("dcc_cpfBirthYear"+i),null,clientMessages[clientSideData.PAGE_CODE+".error.CPFNotInFuture"]);this.input("PAYMENT_CC_DATE_OF_BIRTH_"+i).value("");}else{this.input("dcc_cpfBirthDay_"+i).removeClass("em").selectBox("destroy").selectBox();this.input("dcc_cpfBirthMonth_"+i).removeClass("em").selectBox("destroy").selectBox();this.input("dcc_cpfBirthYear_"+i).removeClass("em").selectBox("destroy").selectBox();this.wdkform("option","errorPanel").errorPanel("removeError",this.input("dcc_cpfBirthYear_"+i),null,clientMessages[clientSideData.PAGE_CODE+".error.CPFNotInFuture"]);this.input("PAYMENT_CC_DATE_OF_BIRTH_"+i).value(this.input("dcc_cpfBirthYear_"+i).value()+""+this.input("dcc_cpfBirthMonth_"+i).value()+""+this.input("dcc_cpfBirthDay_"+i).value()+"0000");}}if($("#billing_adress",$(this)).prop("checked")&&i==2){this.input("PAYMENT_ADDRESS_FIRSTLINE_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterAddress"+i]);this.input("PAYMENT_ADDRESS_FIRSTLINE_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongAddress1"+i],{},clientMessages["GLBL.regexp.billingInformation.addressOne"]);this.input("PAYMENT_ADDRESS_SECONDLINE_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongAddressLine2"+i],{},clientMessages["GLBL.regexp.billingInformation.addressTwo"]);this.input("PAYMENT_ADDRESS_ZIPCODE_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongPostalCode"+i],{},clientMessages["GLBL.regexp.billingInformation.PostalCode"]);this.input("PAYMENT_ADDRESS_ZIPCODE_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterPostCode"+i]);this.input("PAYMENT_ADDRESS_CITY_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongCityName"+i],{},clientMessages["GLBL.regexp.billingInformation.city"]);this.input("PAYMENT_ADDRESS_CITY_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterCity"+i]);if(this.input("PAYMENT_ADDRESS_STATE_"+i).value()!=""){this.input("PAYMENT_ADDRESS_STATE_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongState"+i],{},clientMessages["GLBL.regexp.billingInformation.State"]);}this.input("PAYMENT_ADDRESS_STATE_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterProvince"+i]);if(this.select("PAYMENT_ADDRESS_STATE_"+i).value()!=""){this.select("PAYMENT_ADDRESS_STATE_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongState"+i],{},clientMessages["GLBL.regexp.billingInformation.State"]);}this.select("PAYMENT_ADDRESS_STATE_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterProvince"+i]);$("select[name='PAYMENT_ADDRESS_STATE_"+i+"']").selectBox("refresh");var checkCountry=function(form){if(form.input("PAYMENT_ADDRESS_COUNTRY_CODE_2").value()==""){if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(true,1);setDisabled(true,2);}return false;}return true;};this.input("PAYMENT_ADDRESS_COUNTRY_CODE_2").check(checkCountry(this),clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterCountry"+i]);}else{if(i==1){if(this.input("PAYMENT_ADDRESS_STATE_"+i).value()!=""){this.input("PAYMENT_ADDRESS_STATE_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongState"+i],{},clientMessages["GLBL.regexp.billingInformation.State"]);}this.input("PAYMENT_ADDRESS_STATE_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterProvince"+i]);if(this.select("PAYMENT_ADDRESS_STATE_"+i).value()!=""){this.select("PAYMENT_ADDRESS_STATE_"+i).check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongState"+i],{},clientMessages["GLBL.regexp.billingInformation.State"]);}this.select("PAYMENT_ADDRESS_STATE_"+i).check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterProvince"+i]);$("select[name='PAYMENT_ADDRESS_STATE_1']").selectBox("refresh");}}if(i==2){$("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_2']").selectBox("refresh");}if(clientSideData.PAGE_CODE!="HOTD"&&(this.input("WDS_MOP").value()==""||this.input("WDS_PROVIDER_"+i).value()=="")){this.wdkform("option","errorPanel").errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.ChooseFormOfPayment"]);if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(true,1);setDisabled(true,2);}return false;}if(this.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+i+"_INSTALLMENT_PLAN_ID").value()=="-1"){this.wdkform("option","errorPanel").errorPanel("removeError",this.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+i+"_INSTALLMENT_PLAN_ID"),null,clientMessages[clientSideData.PAGE_CODE+".text.PleaseSelectYourInstallmentPlan"]);this.wdkform("option","errorPanel").errorPanel("addError",this.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+i+"_INSTALLMENT_PLAN_ID"),null,clientMessages[clientSideData.PAGE_CODE+".text.PleaseSelectYourInstallmentPlan"]);this.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+i+"_INSTALLMENT_PLAN_ID").addClass("em").selectBox("destroy").selectBox();if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(true,1);setDisabled(true,2);}return false;}else{this.wdkform("option","errorPanel").errorPanel("removeError",this.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+i+"_INSTALLMENT_PLAN_ID"),null,clientMessages[clientSideData.PAGE_CODE+".text.PleaseSelectYourInstallmentPlan"]);this.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+i+"_INSTALLMENT_PLAN_ID").removeClass("em").selectBox("destroy").selectBox();}}}$("select[name='PAYMENT_ADDRESS_STATE_1'], select[name='PAYMENT_ADDRESS_STATE_2']").selectBox("refresh");}else{var doAddressCheckOnManualEntry=false;if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){var zipcodeSearchErrorPanel=$(currentCEPMop).find(".zipcode_pageError");$(zipcodeSearchErrorPanel).errorPanel();$(zipcodeSearchErrorPanel).errorPanel("reset");var zipcodeSearchWarningPanel=$(currentCEPMop).find(".zipcode_pageWarning");$(zipcodeSearchWarningPanel).errorPanel();$(zipcodeSearchWarningPanel).errorPanel("reset");this.errorPanel("reset");var selectedZipcode=$(currentCEPMop).find("input[name='SELECTED_ZIPCODE']").val();var userEnteredZipcode=$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_ZIPCODE_1']").val();if(!noZipAddressMatched&&selectedZipcode!=userEnteredZipcode.replace("-","")&&(maxCEPLookupFailed[currentMop]<cep_search_max_fail&&maxZipAddressSearchFailed[currentMop]<cep_search_max_fail)){this.wdkform("option","errorPanel").errorPanel("addError",null,null,clientMessages["ALLP.error.UpdatedCEPNoSearchError"]);}else{if(noZipAddressMatched||maxCEPLookupFailed[currentMop]>=cep_search_max_fail||maxZipAddressSearchFailed[currentMop]>=cep_search_max_fail){$("<input>").attr("type","hidden").attr("name","ZIPCODE_MANUAL_ENTRY_ALLFIELDS").attr("value","true").appendTo(currentMockForm);var manualEntryRegExCheckCEP=this.input("PAYMENT_ADDRESS_ZIPCODE_1").check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.WrongPostalCode"],{},clientMessages["GLBL.regexp.billingInformation.PostalCode"]);if(!manualEntryRegExCheckCEP){this.wdkform("option","errorPanel").errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.WrongPostalCode"]);this.input("PAYMENT_ADDRESS_ZIPCODE_1").addClass("em");}else{this.wdkform("option","errorPanel").errorPanel("removeError",this.input("PAYMENT_ADDRESS_ZIPCODE_1"),null,clientMessages[clientSideData.PAGE_CODE+".error.WrongPostalCode"]);this.input("PAYMENT_ADDRESS_ZIPCODE_1").removeClass("em");}doAddressCheckOnManualEntry=true;}}handleRegexCheckForPlaceHolderFields($(currentCEPMop).find("input[name='PAYMENT_ADDRESS_NUMBER_1']"),clientMessages["GLBL.regexp.billingInformation.AddressNumber"],clientMessages[clientSideData.PAGE_CODE+".error.WrongAddressNumber"],true);}if(doAddressCheckOnManualEntry||!clientSideData.CEP_LOOKUP_ENABLED){this.input("PAYMENT_ADDRESS_FIRSTLINE_1").attachCheck(function(val){return(""!=val);},clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterAddress"],{"avoidAddingToPanel":false});this.input("PAYMENT_ADDRESS_FIRSTLINE_1").attachCheck(function(val){return checkAddrStreetRegex(val);},clientMessages[clientSideData.PAGE_CODE+".error.WrongAddress"],{"avoidAddingToPanel":false});}handleRegexCheckForPlaceHolderFields($(currentCEPMop).find("input[name='PAYMENT_ADDRESS_SECONDLINE_1']"),clientMessages["GLBL.regexp.billingInformation.addressTwo"],clientMessages[clientSideData.PAGE_CODE+".error.WrongAddressLine2"],true);setTimeout(function(){$("select[name=PAYMENT_ADDRESS_COUNTRY_CODE_1]").selectBox("destroy").selectBox();},1);this.input("PAYMENT_CC_CUSTOMER_NUMBER_1").check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.CpfNumberWrongFormat"]);this.input("PAYMENT_CC_CUSTOMER_NUMBER_1").check(checkCpf,clientMessages[clientSideData.PAGE_CODE+".error.CpfNumberWrongFormat"],{"avoidAddingToPanel":false});if(this.input("cpfBirthDay").length>0){var dateCheck=checkCpfDOB(this.input("cpfBirthDay").value(),this.input("cpfBirthMonth").value(),this.input("cpfBirthYear").value());if(!dateCheck){this.input("cpfBirthDay").addClass("em").selectBox("destroy").selectBox();this.input("cpfBirthMonth").addClass("em").selectBox("destroy").selectBox();this.input("cpfBirthYear").addClass("em").selectBox("destroy").selectBox();this.wdkform("option","errorPanel").errorPanel("addError",this.input("cpfBirthYear"),null,clientMessages[clientSideData.PAGE_CODE+".error.CPFNotInFuture"]);this.input("PAYMENT_CC_DATE_OF_BIRTH_1").value("");}else{this.input("cpfBirthDay").removeClass("em").selectBox("destroy").selectBox();this.input("cpfBirthMonth").removeClass("em").selectBox("destroy").selectBox();this.input("cpfBirthYear").removeClass("em").selectBox("destroy").selectBox();this.wdkform("option","errorPanel").errorPanel("removeError",this.input("cpfBirthYear"),null,clientMessages[clientSideData.PAGE_CODE+".error.CPFNotInFuture"]);this.input("PAYMENT_CC_DATE_OF_BIRTH_1").value(this.input("cpfBirthYear").value()+""+this.input("cpfBirthMonth").value()+""+this.input("cpfBirthDay").value()+"0000");}}if(this.input("PAYMENT_ADDRESS_STATE_1").value()!=""){this.input("PAYMENT_ADDRESS_STATE_1").check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.WrongState"],{},clientMessages["GLBL.regexp.billingInformation.State"]);}this.input("PAYMENT_ADDRESS_STATE_1").check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterProvince"]);if(this.select("PAYMENT_ADDRESS_STATE_1").value()!=""){this.select("PAYMENT_ADDRESS_STATE_1").check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.WrongState"],{},clientMessages["GLBL.regexp.billingInformation.State"]);}this.select("PAYMENT_ADDRESS_STATE_1").check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterProvince"]);$("[name='PAYMENT_ADDRESS_STATE_1']").selectBox("refresh");if(clientSideData.PAGE_CODE!="HOTD"&&(this.input("WDS_MOP").value()==""||this.input("WDS_PROVIDER_1").value()=="")){this.wdkform("option","errorPanel").errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.ChooseFormOfPayment"]);if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(!isCEPLookupMaxFailReached(),1);}return false;}if(this.input("WDS_PROVIDER_1").value()=="PPAL"&&this.input("cc-issuance").length>0){if(typeof(this.input("cc-issuance").value())=="undefined"){this.wdkform("option","errorPanel").errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.paypalCCIssuancePleaseSelectCCIssuanceCountry"]);return false;}if(this.input("cc-issuance").value()=="BR"){this.wdkform("option","errorPanel").errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".text.paypalCCIssuanceInformationForBrazilianCC"]);return false;}}if(this.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID").value()=="-1"){this.wdkform("option","errorPanel").errorPanel("removeError",this.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID"),null,clientMessages[clientSideData.PAGE_CODE+".text.PleaseSelectYourInstallmentPlan"]);this.wdkform("option","errorPanel").errorPanel("addError",this.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID"),null,clientMessages[clientSideData.PAGE_CODE+".text.PleaseSelectYourInstallmentPlan"]);this.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID").addClass("em").selectBox("destroy").selectBox();if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(!isCEPLookupMaxFailReached(),1);}return false;}else{this.wdkform("option","errorPanel").errorPanel("removeError",this.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID"),null,clientMessages[clientSideData.PAGE_CODE+".text.PleaseSelectYourInstallmentPlan"]);this.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID").removeClass("em").selectBox("destroy").selectBox();}}if(clientSideData.PAGE_CODE!="HOTD"&&!$("input[name='WDS_ACCEPT_TERMS']").is(":disabled")&&typeof $("input[name='WDS_ACCEPT_TERMS']").value()==="undefined"){this.wdkform("option","errorPanel").errorPanel("removeError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.MessageReadConditions"]);this.wdkform("option","errorPanel").errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.MessageReadConditions"]);if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(!isCEPLookupMaxFailReached(),1);}return false;}else{this.wdkform("option","errorPanel").errorPanel("removeError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.MessageReadConditions"]);}}},prepareSubmit:function(){$.blockUI();if((clientSideData.PAGE_CODE=="FSRS"&&typeof(fsrsController)!=="undefined"&&fsrsController.getSeatChanged()==true)||clientSideData.PAGE_CODE!="FSRS"||(clientSideData.PAGE_CODE=="FSRS"&&typeof(fsrsController)!=="undefined"&&fsrsController.getPaymentRequired())){$("input[name='WDS_ACCEPT_TERMS']").prop("disabled",true);var nbOfCC=1;if($(this).parents(".mop_DoubleCreditCard").length>0){nbOfCC=2;}for(var i=1;i<(nbOfCC+1);i++){if(this.input("PAYMENT_CC_EXP_"+i).length>0){this.input("PAYMENT_CC_EXP_"+i).value(this.input("WDS_EXPIRY_MONTH_"+i).value()+"/"+this.input("WDS_EXPIRY_YEAR_"+i).value().replace(/[0-9][0-9]/,""));this.input("WDS_EXPIRY_YEAR_"+i).prop("disabled",true);this.input("WDS_EXPIRY_MONTH_"+i).prop("disabled",true);}if(this.input("dcc_cpfBirthDay_"+i).length>0){this.input("PAYMENT_CC_DATE_OF_BIRTH_"+i).prop("disabled",false);this.input("dcc_cpfBirthDay_"+i).prop("disabled",true);this.input("dcc_cpfBirthMonth_"+i).prop("disabled",true);this.input("dcc_cpfBirthYear_"+i).prop("disabled",true);if(this.input("PAYMENT_ADDRESS_SECONDLINE_"+i).value()==""&&i==1){this.input("PAYMENT_ADDRESS_SECONDLINE_"+i).prop("disabled",true);}else{if(this.input("PAYMENT_ADDRESS_SECONDLINE_"+i).value()==""&&i==2&&$("#billing_adress")){this.input("PAYMENT_ADDRESS_SECONDLINE_"+i).prop("disabled",true);}}}if(this.input("PAYMENT_CC_DATE_OF_BIRTH_"+i).value()==""){this.input("PAYMENT_CC_DATE_OF_BIRTH_"+i).prop("disabled",true);}if(rememberInformation!=null){savedData=savedData||{};savedData["MOP"]=currentMop;savedData["PROVIDER_"+i]=$(".doubleCC",$(this)).eq(i).find("ul li.selected").data("name");var billingInformation={};if(this.input("PAYMENT_ADDRESS_FIRSTLINE_"+i)!=null){billingInformation["LINE_ONE"]=this.input("PAYMENT_ADDRESS_FIRSTLINE_"+i).value();billingInformation["LINE_TWO"]=this.input("PAYMENT_ADDRESS_SECONDLINE_"+i).value();billingInformation["POSTAL_CODE"]=this.input("PAYMENT_ADDRESS_ZIPCODE_"+i).value().replace("-","");billingInformation["CITY"]=this.input("PAYMENT_ADDRESS_CITY_"+i).value();billingInformation["STATE"]=this.input("PAYMENT_ADDRESS_STATE_"+i).value();billingInformation["COUNTRY"]=this.select("PAYMENT_ADDRESS_COUNTRY_"+i).value();savedData["BILLING_"+i]=billingInformation;}savedData["TMP_RESELECT_INSURANCE"]=insuranceInput.val();$.jStorage.set(DEF_SAVED_DATA,savedData);}var correctValue=function(value){return(""+value).ignoreAccent().replace(/â€“/g,"-");};this.input("PAYMENT_ADDRESS_FIRSTLINE_"+i).value(correctValue(this.input("PAYMENT_ADDRESS_FIRSTLINE_"+i).value()));this.input("PAYMENT_ADDRESS_SECONDLINE_"+i).value(correctValue(this.input("PAYMENT_ADDRESS_SECONDLINE_"+i).value()));var paymentAddressZipcode=correctValue(this.input("PAYMENT_ADDRESS_ZIPCODE_"+i).value());if(undefined!=paymentAddressZipcode){this.input("PAYMENT_ADDRESS_ZIPCODE_"+i).value(paymentAddressZipcode.replace("-",""));}this.input("PAYMENT_ADDRESS_CITY_"+i).value(correctValue(this.input("PAYMENT_ADDRESS_CITY_"+i).value()));$("[name='PAYMENT_ADDRESS_STATE_"+i+"']",currentMockForm).val(correctValue($("[name='PAYMENT_ADDRESS_STATE_"+i+"']",currentMockForm).val()+""));this.input("PAYMENT_CC_FULL_HOLDER_NAME_"+i).value(correctValue(this.input("PAYMENT_CC_FULL_HOLDER_NAME_"+i).value()));this.input("PAYMENT_CC_HOLDER_FIRST_NAME_"+i).value(correctValue(this.input("PAYMENT_CC_HOLDER_FIRST_NAME_"+i).value()));this.input("PAYMENT_CC_HOLDER_LAST_NAME_"+i).value(correctValue(this.input("PAYMENT_CC_HOLDER_LAST_NAME_"+i).value()));var paymentCCCustomerNumberInput=this.input("PAYMENT_CC_CUSTOMER_NUMBER_"+i);if(paymentCCCustomerNumberInput.length>0){paymentCCCustomerNumberInput.value(paymentCCCustomerNumberInput.value().replace(/[\.\-]/g,""));}}currentMockForm.find("input").filter(":visible").each(function(){$(this).val(($(this).val()+"").toUpperCase());});if(nbOfCC==2&&!$("#billing_adress").prop("checked")){this.input("PAYMENT_ADDRESS_FIRSTLINE_2").value(this.input("PAYMENT_ADDRESS_FIRSTLINE_1").value());this.input("PAYMENT_ADDRESS_SECONDLINE_2").value(this.input("PAYMENT_ADDRESS_SECONDLINE_1").value());this.input("PAYMENT_ADDRESS_ZIPCODE_2").value(this.input("PAYMENT_ADDRESS_ZIPCODE_1").value().replace("-",""));this.input("PAYMENT_ADDRESS_CITY_2").value(this.input("PAYMENT_ADDRESS_CITY_1").value());$("[name='PAYMENT_ADDRESS_COUNTRY_CODE_2']").val($("[name='PAYMENT_ADDRESS_COUNTRY_CODE_1']",currentMockForm).val()).selectBox("refresh").trigger("change");$("[name='PAYMENT_ADDRESS_STATE_2']").val($("[name='PAYMENT_ADDRESS_STATE_1']",currentMockForm).val());}if(nbOfCC==2&&!$("#security_adress").prop("checked")){this.input("PAYMENT_CC_FULL_HOLDER_NAME_2").value(this.input("PAYMENT_CC_FULL_HOLDER_NAME_1").value());this.input("PAYMENT_CC_CUSTOMER_NUMBER_2").value(this.input("PAYMENT_CC_CUSTOMER_NUMBER_1").value());this.input("PAYMENT_CC_DATE_OF_BIRTH_2").value(this.input("PAYMENT_CC_DATE_OF_BIRTH_1").value());}if(!installmentsCallMade){currentMockForm.find("input[name='PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID']").prop("disabled",true);}}if(clientSideData.PAGE_CODE=="FSRS"||clientSideData.PAGE_CODE=="RD_ATC_PURF"){currentMockForm.append($("form#FSR_FORM input").clone());currentMockForm.find("input[name='CONTACT_POINT_EMAIL_1']").prop("disabled",true);currentMockForm.find("input[name='CONTACT_POINT_PHONE_TYPE_1']").prop("disabled",true);}}});}var currentMockForm=$("form[id='MOP_FORM_0']");var pageErrorDiv=$("#pageError_0");if($("form[id='MOP_FORM_0']").length==0){currentMockForm=$("form[id='MOP_FORM_1']");pageErrorDiv=$("#pageError_1");}var installmentsForm=wdk.form("GET_INSTALLMENTS",{ajaxSubmit:true,ajaxOptions:{dataType:"json",success:function(data){var installmentsWarningDiv=$("#pageWarningInstallments_1");if(currentMockForm.parent().attr("id")=="target_d0"){installmentsWarningDiv=$("#pageWarningInstallments_0");}else{if(currentMockForm.parent().attr("id")=="target_d2"){installmentsWarningDiv=$("#pageWarningInstallments_2");}}var ccId=installmentsContainer.parents(".doubleCC").data("ccid");if(typeof ccId!=="undefined"&&ccId!=null){installmentsWarningDiv=$("#pageWarningInstallments_dcc_"+ccId);}if(data.mapDataOut.INSTALLMENT_PLAN_OFFERED){installmentsWarningDiv.hide();installmentsWarningDiv.find("ul").remove();installmentsContainer.find("select").selectBox("destroy").remove();var x=[];if(typeof ccId!=="undefined"&&ccId!=null){x[x.length]={"data":data.mapDataOut,"ccId":ccId};var installments=$(tamUtils.getElementForTmpls(template_installments.template.tmpl(x)));installmentsContainer.append(installments);currentMockForm.find("div[id='doubleCCInstallments"+ccId+"']").removeClass("none");currentMockForm.find("div[id='doubleCCInstallments"+ccId+"'] span[id='installmentsContainer'] select").selectBox();}else{x[x.length]={"data":data.mapDataOut,"ccId":1,"tabindex":"105"};var installments=$(tamUtils.getElementForTmpls(template_installments.template.tmpl(x)));installmentsContainer.append(installments);currentMockForm.find("div[id='sectionInstallments']").removeClass("none");currentMockForm.find("span[id='installmentsContainer'] select").selectBox();}installmentsOffered=true;installmentsInformation=data.mapDataOut.INSTALLMENT_PLAN;$("#installmentsContainer").qtip("destroy");}else{installmentsWarningDiv.find("ul").remove();installmentsWarningDiv.append("<ul class='wdk-errorpanel-list'><li class='wdk-errorpanel-item icob'>"+clientMessages[clientSideData.PAGE_CODE+".error.NoInstallmentsAvailableForThisCard"]+"</li></ul>");installmentsWarningDiv.show();if(typeof ccId!=="undefined"&&ccId!=null){clearInstallments(ccId);}else{clearInstallments();}}lock=false;$(document).trigger("xhr_pop");$.unblockUI();},error:function(){pageErrorDiv=currentMockForm.wdkform("option","errorPanel");$.unblockUI();}},errorPanel:pageErrorDiv});var currentMop=undefined;var currentProvider=undefined;var currentProvider2=undefined;var previousProvider=undefined;var installmentsInformation=undefined;var insPopin=undefined;var installmentsPopin=$("#installmentsPopin");var searchZipAddressPopin=$(".cep-link");var cep_search_popin=undefined;var cep_search_rslt_popin=undefined;var cep_search_max_fail=clientSideData.CEP_LOOKUP_MAX_FAIL;var installmentSelected=undefined;var installmentsContainer=undefined;var mops=$("label.boxw input");var providers=$("li.boxg");var installmentsSelect=$("span[id='installmentsContainer'] select");var insuranceInput=$("input[name='WDS_INSURANCE_UI']");var DEF_CC_NUMBER="PAYMENT_CC_NUMBER_1";var DEF_CVC="PAYMENT_CC_DIGIT_CODE_1";var rememberInformation=clientSideData.REMEMBER_INFORMATION;var DEF_SAVED_DATA="WDS_SAVED_PURF";var savedData=$.jStorage.get(DEF_SAVED_DATA);var submitHoldForInsPopin=false;var hasErrorOnZipCodeService=false;function applyCCLimits(divSet,config,inputName){var maxLength=Math.max.apply(Math,config["CCLENGTH"].split(","));divSet.find("input[name='"+inputName+"']").attr("maxLength",maxLength);}function applyCVCLimits(divSet,config,inputName){var maxLength=Math.max.apply(Math,config["CVC_MAX_LENGTH"].split(","));divSet.find("input[name='"+inputName+"']").removeAttr("maxLength").attr("maxLength",maxLength);var allowedCVC=config["CVC_MAX_LENGTH"].split(",");if(allowedCVC.length==2){var securityCodeInfo=clientMessages["PURF.text.CVVSecurityCodeInformation"];securityCodeInfo=securityCodeInfo.replace("{0}",allowedCVC[0]).replace("{1}",allowedCVC[1]);divSet.find(".securitycodeinfo").text(securityCodeInfo);}else{var securityCodeInfo=clientMessages["PURF.text.SecurityCodeInformation"];divSet.find(".securitycodeinfo").text(securityCodeInfo);}}function changeCVCIcon(divSet,config){var cvcImage=config["CVC_IMAGE"];if(typeof cvcImage!=="undefined"){var patt=/[A-z0-9-_]*\.[A-z]*$/g;var newPath=divSet.find("img#cvcImage").attr("src").replace(patt,"");divSet.find("img#cvcImage").attr("src",newPath+cvcImage);}}function toggleCvc(divSet,config,inputName){var isCvc=config["IS_CVC"];if(isCvc==true){divSet.find("input[name='"+inputName+"']").removeAttr("disabled").parent().parent().show();}else{divSet.find("input[name='"+inputName+"']").attr("disabled","disabled").parent().parent().hide();}}function updateDebditCardCvc(divSet,config,inputName){var cvcReq=config["CVC_REQ"];var cvcMaxLength=Math.max.apply(Math,config["CVC_MAX_LENGTH"].split(","));var cvcMinLength=(cvcReq=="MANDATORY")?cvcMaxLength:0;var cvcRegExp="^([0-9]{"+cvcMaxLength+"})$";if(cvcReq=="OPTIONAL"){cvcRegExp="^([0-9]{"+cvcMaxLength+"})?$";$(".debitCardCvcInfoOptional").show();$(".debitCardCvcInfoMandatory").hide();}else{$(".debitCardCvcInfoOptional").hide();$(".debitCardCvcInfoMandatory").show();}divSet.find("input[name='"+inputName+"']").attr("maxLength",cvcMaxLength);divSet.find("input[name='"+inputName+"']").attr("data-wdk-validate-min-length",cvcMinLength);divSet.find("input[name='"+inputName+"']").attr("data-wdk-validate-regexp",cvcRegExp);}function initSb(){$("#expiryDateMonth,#expiryDateYear,#cpfBirthDay,#cpfBirthMonth,#cpfBirthYear, #purf_country").selectBox();$("#expiryDateMonth_1,#expiryDateYear_1,#dcc_cpfBirthDay_1,#dcc_cpfBirthMonth_1,#dcc_cpfBirthYear_1, #purf_country_1").selectBox();$("#expiryDateMonth_2,#expiryDateYear_2,#dcc_cpfBirthDay_2,#dcc_cpfBirthMonth_2,#dcc_cpfBirthYear_2, #purf_country_2").selectBox();}function initCountryPreselectionForBillingAddress(){var target_d=$("input[name='radio2']").parent().filter(".active").attr("id");if(clientSideData.PAGE_CODE==="HOTD"){target_d="d0";}var country_preselection=clientSideData["WDS_MARKET_TO_COUNTRY_MAPPING"][clientSideData.WDS_MARKET];if($("input[name='radio2']").parent().filter(".active").data("code")=="DCC"){$("#target_"+target_d).find("#purf_country_1 option[value='"+country_preselection+"']").attr("selected","selected");$("#target_"+target_d).find("#purf_country_1").selectBox("refresh");$("#target_"+target_d).find("#purf_country_2 option[value='"+country_preselection+"']").attr("selected","selected");$("#target_"+target_d).find("#purf_country_2").selectBox("refresh");initStateField(1);initStateField(2);}else{$("#target_"+target_d).find("#purf_country option[value='"+country_preselection+"']").attr("selected","selected");$("#target_"+target_d).find("#purf_country").selectBox("refresh");initStateField();if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(!isCEPLookupMaxFailReached(),1);}}}function isCEPLookupMaxFailReached(){return maxCEPLookupFailed[currentMop]>=cep_search_max_fail||maxZipAddressSearchFailed[currentMop]>=cep_search_max_fail;}function initStateField(ccId){if(typeof(ccId)=="undefined"){ccId="";stateFieldNumber=1;}else{stateFieldNumber=ccId;ccId="_"+ccId;}var target_d=$("input[name='radio2']").parent().filter(".active").attr("id");if(clientSideData.PAGE_CODE==="HOTD"){target_d="d0";}$("#target_"+target_d).find("#purf_country"+ccId).selectBox("refresh");var tbIndex=$($("#target_"+target_d).find("[id^='purf_state']").get(stateFieldNumber-1)).attr("tabindex");var country=$("#target_"+target_d).find("#purf_country"+ccId+" option:selected").val();var cls="";if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")&&(maxCEPLookupFailed[currentMop]<cep_search_max_fail)){cls="selectBox-label cep-input";}var stateValues=[];if(country!=undefined&&clientSideData["WDS_STATE_CODES_LIST"][country]!=undefined){$.each(clientSideData["STATE_LABELS"][country],function(){stateValues[stateValues.length]=clientSideData["WDS_STATE_CODES_LIST"][country][stateValues.length];});var data=[];var stateValues=[];$.each(clientSideData["STATE_LABELS"][country],function(){stateValues[stateValues.length]=clientSideData["WDS_STATE_CODES_LIST"][country][stateValues.length];});data[data.length]={"states":clientSideData["STATE_LABELS"][country],"country":country,"stateValues":stateValues,"stateFieldNumber":stateFieldNumber,"tbIndex":tbIndex,"cls":cls};var popin=$(tamUtils.getElementForTmpls($("#template_stateDropDownTemplate"+ccId).tmpl(data)));if(popin!=undefined){if($("input[name='radio2']:checked").parent().data("code")=="DCC"){$("#target_"+target_d+" .dcc"+stateFieldNumber).find("#purfStateSpan").html(popin);$("#target_"+target_d+" .dcc"+stateFieldNumber).find("#purfStateSpan select").selectBox();$("select[name='PAYMENT_ADDRESS_STATE_1']").on("change",function(){if(!$("#billing_adress").prop("checked")){$("#target_"+target_d+" select[name='PAYMENT_ADDRESS_STATE_2'] option[value='"+$("#target_"+target_d+" select[name='PAYMENT_ADDRESS_STATE_1'] option:selected").val()+"']").attr("selected","selected");$("#target_"+target_d+" select[name='PAYMENT_ADDRESS_STATE_2']").selectBox("refresh");}$(this).selectBox("refresh");});}else{$("#target_"+target_d).find("#purfStateSpan").html(popin);$("#target_"+target_d).find("#purfStateSpan select").selectBox();$("input[name='PAYMENT_ADDRESS_STATE_1']").on("change",function(){if(!$("#billing_adress").prop("checked")){$("#target_"+$("input[name='radio2']:checked").parent().attr("id")+" [name='PAYMENT_ADDRESS_STATE_2']").val($("#target_"+$("input[name='radio2']:checked").parent().attr("id")+" [name='PAYMENT_ADDRESS_STATE_1']").val());}});}}}else{var popin=$(tamUtils.getElementForTmpls($("#template_stateInputTemplate"+ccId).tmpl({"tbIndex":tbIndex})));if(popin!=undefined&&($("input[name='PAYMENT_ADDRESS_STATE_1'][type!=hidden]").length===0||$("input[name='PAYMENT_ADDRESS_STATE_1'][type!=hidden]").val()==="")){if($("input[name='radio2']:checked").parent().data("code")=="DCC"){$("#target_"+target_d+" .dcc"+stateFieldNumber).find("#purfStateSpan").html(popin);}else{$("#target_"+target_d).find("#purfStateSpan").html(popin);}}}if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){setDisabled(!isCEPLookupMaxFailReached(),stateFieldNumber);}}function initCepSearchStateField(){var cls="selectBox-label";var tbIndex=$($("#SEARCH_CEP_FORM").find("[id^='dkmc_purf_state']").get(stateFieldNumber-1)).attr("tabindex");var country=$("#SEARCH_CEP_FORM").find("#dkmc_purf_country option:selected").val();var stateValues=[];if(country!=undefined&&clientSideData["WDS_STATE_CODES_LIST"][country]!=undefined){$.each(clientSideData["STATE_LABELS"][country],function(){stateValues[stateValues.length]=clientSideData["WDS_STATE_CODES_LIST"][country][stateValues.length];});var data=[];var stateValues=[];$.each(clientSideData["STATE_LABELS"][country],function(){stateValues[stateValues.length]=clientSideData["WDS_STATE_CODES_LIST"][country][stateValues.length];});data[data.length]={"states":clientSideData["STATE_LABELS"][country],"country":country,"stateValues":stateValues,"stateFieldNumber":1,"tbIndex":tbIndex,"cls":cls};var popin=$(tamUtils.getElementForTmpls($("#template_cepSearchStateDropDownAciTemplate").tmpl(data)));if(popin!=undefined&&($("select[name='DKMC_PAYMENT_ADDRESS_STATE_1']").length===0||$("select[name='DKMC_PAYMENT_ADDRESS_STATE_1']").val()==="")){$("#SEARCH_CEP_FORM").find("#purfStateSpan").html(popin);var cepSearchFormSelect=$("#SEARCH_CEP_FORM").find("#purfStateSpan select");cepSearchFormSelect.selectBox();cepSearchFormSelect.attr("data-wdk-validate-regexp-error",clientMessages[clientSideData.PAGE_CODE+".error.WrongState"]);cepSearchFormSelect.attr("data-wdk-validate-regexp",clientMessages["GLBL.regexp.billingInformation.State"]);cepSearchFormSelect.attr("data-wdk-validate-mandatory-error",clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterProvince"]);cepSearchFormSelect.attr("data-wdk-validate-mandatory",true);cepSearchFormSelect.on("change",function(){var a=$("#SEARCH_CEP_FORM").find("#purfStateSpan a");if(a.hasClass("em")&&a.find(".selectBox-label").text()!=""){a.removeClass("em");}});}}else{var popin=$(tamUtils.getElementForTmpls($("#template_cepSearchStateInputTemplate").tmpl({"tbIndex":tbIndex})));if(popin!=undefined&&($("input[name='DKMC_PAYMENT_ADDRESS_STATE_1'][type!=hidden]").length===0||$("input[name='DKMC_PAYMENT_ADDRESS_STATE_1'][type!=hidden]").val()==="")){$("#SEARCH_CEP_FORM").find("#purfStateSpan").html(popin);var cepSearchFormInput=$("#SEARCH_CEP_FORM").find("#purfStateSpan input");cepSearchFormInput.attr("data-wdk-validate-regexp-error",clientMessages[clientSideData.PAGE_CODE+".error.WrongState"]);cepSearchFormInput.attr("data-wdk-validate-regexp",clientMessages["GLBL.regexp.billingInformation.State"]);cepSearchFormInput.attr("data-wdk-validate-mandatory-error",clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterProvince"]);cepSearchFormInput.attr("data-wdk-validate-mandatory",true);}}}function changeTab(clickedTab,form,mop){var clickedId=$(clickedTab).attr("id");var mopPanelId="#target_"+clickedId;currentCEPMop=mopPanelId;$("#target_"+clickedId+" .cuilCuitDdown").off("change").on("change",function(){if($(this).val()==""){$("#target_"+clickedId+" .cuilCuitInput").prop("disabled",true);$("#target_"+clickedId+" .cuilCuitInput").parent().addClass("none");}else{$("#target_"+clickedId+" .cuilCuitInput").prop("disabled","");$("#target_"+clickedId+" .cuilCuitInput").parent().removeClass("none");}});$(".wrap [id^='target_d']").addClass("none");$(mopPanelId).removeClass("none");$(".wrap [id^='target_d']").find("input").prop("disabled",true);$(mopPanelId).find("input").prop("disabled",false);if(undefined!==previousProvider){currentProvider=previousProvider;}if(clientSideData.CEP_LOOKUP_ENABLED&&mop!="DoubleCreditCard"){$(".wrap [id^='target_d']").find(".find_address_of_CEP").prop("disabled",true);$(mopPanelId).find(".find_address_of_CEP").prop("disabled",false);$(".wrap [id^='target_d']").find(".zipcode_search_error").prop("disabled",true);$(mopPanelId).find(".zipcode_search_error").prop("disabled",false);$(".wrap [id^='target_d']").find(".zipcode_pageError").prop("disabled",true);$(mopPanelId).find(".zipcode_pageError").prop("disabled",false);$(".wrap [id^='target_d']").find(".zipcode_pageWarning").prop("disabled",true);$(mopPanelId).find(".zipcode_pageWarning").prop("disabled",false);$(".wrap [id^='target_d']").find(".zipcode_pageWarning").prop("disabled",true);$(mopPanelId).find(".zipcode_pageWarning").prop("disabled",false);$(mopPanelId).find(".zipcode_pageError").errorPanel("reset");$(mopPanelId).find(".zipcode_pageWarning").errorPanel("reset");$(mopPanelId).find(".zipcode_pageInformation").errorPanel("reset");$(".wrap [id^='target_d']").find(".zipcode_search_idontknow").prop("disabled",true);$(mopPanelId).find(".zipcode_search_idontknow").prop("disabled",false);setDisabled(!isCEPLookupMaxFailReached(),1);}$(".wrap [id^='d'][class^='block boxw']").removeClass("active").addClass("caption");$(clickedTab).addClass("active").removeClass("caption");if(!insuranceInput.is(":hidden")){if(typeof insuranceInput.filter(":checked")!=="undefined"&&insuranceInput.filter(":checked").val()=="true"){checkInsParam(true);}else{checkInsParam(false);}}$("#mainOuter select:visible").selectBox();initCountryPreselectionForBillingAddress();}function handleSuccessfulAddressSearchFromCEP(zipAddress){var zipcodeSearchErrorPanel=$(currentCEPMop).find(".zipcode_pageError");var zipcodeSearchWarningPanel=$(currentCEPMop).find(".zipcode_pageWarning");resetZipCodeSearchErrorPanel(zipcodeSearchErrorPanel,zipcodeSearchWarningPanel);if(zipAddress){$("input[name='SELECTED_ZIPCODE']").val(zipAddress.zipCode);$(currentCEPMop).wdkform("option","errorPanel").errorPanel("removeError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterAddress"]);$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_1']").removeClass("em");$(currentCEPMop).wdkform("option","errorPanel").errorPanel("removeError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterCity"]);$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_CITY_1']").removeClass("em");setDisabled(true,1);if(isIncompleteResponse(zipAddress)){$(zipcodeSearchWarningPanel).errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.CEPWarningResponseIncomplete"]);}var streetAddr1=zipAddress.addressType||"";if(zipAddress.address){streetAddr1=streetAddr1.trim()+" "+zipAddress.address.trim();}streetAddr1=streetAddr1.trim();var i=1;var zipCodeWithHypen="";if(zipAddress.zipCode){var firstFiveDigits=zipAddress.zipCode.substring(0,5);var lastThreeDigits=zipAddress.zipCode.substring(5);zipCodeWithHypen=firstFiveDigits+"-"+lastThreeDigits;}fillCepValues($(currentCEPMop).find("input[name='PAYMENT_ADDRESS_ZIPCODE_"+i+"']"),zipCodeWithHypen,false);fillCepValues($(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+i+"']"),streetAddr1,false);fillCepValues($(currentCEPMop).find("input[name='PAYMENT_ADDRESS_CITY_"+i+"']"),zipAddress.city,false);fillCepValues($(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+i+"']"),zipAddress.state,true);}else{if(maxCEPLookupFailed[currentMop]<cep_search_max_fail){maxCEPLookupFailed[currentMop]=maxCEPLookupFailed[currentMop]+1;$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,clientMessages["ALLP.error.CEPErrorNoResponse"]);}else{$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,clientMessages["ALLP.error.CEPErrorEnterManually"]);setDisabled(false,1);hideCepSearch();$("<input>").attr("type","hidden").attr("name","ZIPCODE_MANUAL_ENTRY_ALLFIELDS").attr("value","true").appendTo(currentMockForm);}}}function resetZipCodeSearchErrorPanel(zipcodeSearchErrorPanel,zipcodeSearchWarningPanel){$(zipcodeSearchErrorPanel).errorPanel();$(zipcodeSearchErrorPanel).errorPanel("reset");$(zipcodeSearchWarningPanel).errorPanel();$(zipcodeSearchWarningPanel).errorPanel("reset");}function handleErrorWithZipCodeService(errorData){var zipcodeSearchErrorPanel=$(currentCEPMop).find(".zipcode_pageError");var zipcodeSearchWarningPanel=$(currentCEPMop).find(".zipcode_pageWarning");if(errorData!=null||errorData!=undefined){resetZipCodeSearchErrorPanel(zipcodeSearchErrorPanel,zipcodeSearchWarningPanel);hasErrorOnZipCodeService=false;for(var i=0;i<errorData.length;i++){var error=errorData[i];if(error.TYPE=="E"){hasErrorOnZipCodeService=true;$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,error.TEXT);}else{$(zipcodeSearchWarningPanel).errorPanel("addError",null,null,error.TEXT);}}if(hasErrorOnZipCodeService){maxCEPLookupFailed[currentMop]=maxCEPLookupFailed[currentMop]+1;if(maxCEPLookupFailed[currentMop]>=cep_search_max_fail){$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,clientMessages["ALLP.error.CEPErrorEnterManually"]);setDisabled(false,1);$("<input>").attr("type","hidden").attr("name","ZIPCODE_MANUAL_ENTRY_ALLFIELDS").attr("value","true").appendTo(currentMockForm);hideCepSearch();}}}else{resetZipCodeSearchErrorPanel(zipcodeSearchErrorPanel,zipcodeSearchWarningPanel);}}function handleRegexCheckForPlaceHolderFields(field,fielRegEx,errorMsg,onSubmitCheck){var zipcodeSearchErrorPanel=$(currentCEPMop).find(".zipcode_pageError");$(zipcodeSearchErrorPanel).errorPanel("reset");$(zipcodeSearchErrorPanel).errorPanel();var fieldValueForValidation=field.val();if(fieldValueForValidation==clientMessages[clientSideData.PAGE_CODE+".text.Optional"]){field.val(" ");}fieldValueForValidation=$.trim(fieldValueForValidation);if(fieldValueForValidation!=""&&fieldValueForValidation!=" "){if(!new RegExp(fielRegEx).test(fieldValueForValidation)){$(zipcodeSearchErrorPanel).errorPanel("addError",field,null,errorMsg);}else{field.removeClass("em");}field.val(fieldValueForValidation);}else{if(onSubmitCheck){field.val(" ");field.removeClass("em");}else{field.val("");field.removeClass("em");}}}function isIncompleteResponse(zipAddress){var addressType=zipAddress.addressType,address=zipAddress.address,zipCode=zipAddress.zipCode,city=zipAddress.city,state=zipAddress.state;return !addressType||addressType.trim()==""||!address||address.trim()==""||!zipCode||zipCode.trim()==""||!city||city.trim()==""||!state||state.trim()=="";}function setDisabled(isDisabled,ccId){$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+ccId+"']").prop("readonly",isDisabled);$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_CITY_"+ccId+"']").prop("readonly",isDisabled);$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_"+ccId+"']").prop("disabled",isDisabled);$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").prop("disabled",isDisabled);if(isDisabled){$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+ccId+"']").addClass("cep-input");$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_CITY_"+ccId+"']").addClass("cep-input");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_"+ccId+"']").addClass("cep-input");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_"+ccId+"']").selectBox("refresh");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").removeClass("selectBox");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").addClass("selectBox-label");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").addClass("cep-input");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").selectBox("refresh");}else{$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+ccId+"']").removeClass("cep-input");$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_CITY_"+ccId+"']").removeClass("cep-input");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_"+ccId+"']").removeClass("cep-input");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_"+ccId+"']").selectBox("refresh");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").addClass("selectBox");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").removeClass("selectBox-label");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").removeClass("cep-input");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").selectBox("refresh");}}function clearCEPFields(ccId){if(!isCEPLookupMaxFailReached()){$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+ccId+"']").val("");$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_CITY_"+ccId+"']").val("");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").val("");$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_NUMBER_"+ccId+"']").val("");$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_SECONDLINE_"+ccId+"']").val("");$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_"+ccId+"']").selectBox("refresh");}}function fillCepValues(field,value,isStateField){if(value&&value!=""){field.val(value);if(isStateField){if(field.is("select")){$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_1'] option[value='"+value+"']").attr("selected","selected");$("select[name='PAYMENT_ADDRESS_STATE_1']").selectBox("refresh");}else{$(currentCEPMop).find("[name='PAYMENT_ADDRESS_STATE_1']").val(value);$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_STATE_1']").selectBox("refresh");}}}else{field.prop("disabled",false);field.prop("readonly",false);field.removeClass("cep-input");field.removeClass("selectBox-label");field.addClass("selectBox");field.selectBox("refresh");}}function hideCepSearch(){$(currentCEPMop).find(".find_address_of_CEP").hide();$(currentCEPMop).find(".zipcode_search_idontknow").hide();$(currentCEPMop).find("#zipcode_search_idontknow_link").hide();}function checkProviderSelection(mop){var activeMopDiv=$(".mop_"+mop);if(activeMopDiv.find("ul li.selected").length==1){activeMopDiv.find("ul li.selected").eq(0).click();}else{if(activeMopDiv.find("ul li.selected").length>1){activeMopDiv.find("ul li.selected").eq(0).click();activeMopDiv.find("ul li.selected").eq(1).click();}else{if(mop=="DoubleCreditCard"){$(".doubleCC",$(activeMopDiv)).eq(0).find("ul li").eq(0).click();$(".doubleCC",$(activeMopDiv)).eq(1).find("ul li").eq(0).click();}else{activeMopDiv.find("ul li").eq(0).click();}}}}function clearInstallments(ccId){$(document).trigger("removeInstallments");if(typeof ccId!=="undefined"&&ccId=="all"){currentMockForm.find("div[id='doubleCCInstallments1']").addClass("none");currentMockForm.find("div[id='doubleCCInstallments2']").addClass("none");currentMockForm.find("div[id='sectionInstallments']").addClass("none");currentMockForm.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID").value("0");currentMockForm.input("PAYMENT_GROUP_2_LIST_PAYMENT_"+ccId+"_INSTALLMENT_PLAN_ID").value("0");}else{if(typeof ccId!=="undefined"&&ccId!=null){currentMockForm.find("div[id='doubleCCInstallments"+ccId+"']").addClass("none");currentMockForm.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+ccId+"_INSTALLMENT_PLAN_ID").value("0");}else{currentMockForm.find("div[id='sectionInstallments']").addClass("none");currentMockForm.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID").value("0");}}}function showInsPopin(){insPopin=$("#insu").dialog({autoOpen:true,draggable:false,width:800,modal:true,resizable:false});$("#ui-dialog-title-insurancePopin").parent().find(".ui-dialog-titlebar-close").hide();}function checkInsParam(off){currentMockForm.input("SELECTED_INSURANCE_PROVIDER_CODE_1").prop("disabled",!off);currentMockForm.input("SELECTED_INSURANCE_PRODUCT_CODE_1").prop("disabled",!off);currentMockForm.input("SELECTED_INSURANCE_TRAVELLER_ID_1").prop("disabled",!off);if(!off){currentMockForm.input("WDS_INSURANCE").value("FALSE");}else{currentMockForm.input("WDS_INSURANCE").value("TRUE");}}var dccSecondErrorMsg={"al1":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongAddressLine22"],"al2":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongAddress12"],"pc":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongPostalCode2"],"cn":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongCityName2"],"s":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongState2"],"s1":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongState"],"cpf":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongEnterCpfName2"],"ctr":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.WrongCountry2"],"ctr2":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterCountry2"],"f":clientMessages[clientSideData.PAGE_CODE+".error.Docid.CpfNumberWrongFormat2"],"f1":clientMessages[clientSideData.PAGE_CODE+".error.Docid.CpfNumberWrongFormat1"],"prov1":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterProvince"],"prov2":clientMessages[clientSideData.PAGE_CODE+".error.DccBilling.NeedToEnterProvince2"]};function initDccSpecialValidation(){var handleMessages=function(regexp,message,val,elem){if(!(new RegExp(regexp).test(val))){elem.addClass("em");currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,message);currentMockForm.wdkform("option","errorPanel").errorPanel("addError",null,null,message);}else{currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,message);elem.removeClass("em");}};$("input[name='PAYMENT_ADDRESS_FIRSTLINE_2'],"+"input[name='PAYMENT_ADDRESS_SECONDLINE_2'],"+"input[name='PAYMENT_ADDRESS_ZIPCODE_2'],"+"input[name='PAYMENT_ADDRESS_CITY_2'],"+"input[name='PAYMENT_ADDRESS_STATE_2'],"+"select[name='PAYMENT_ADDRESS_STATE_2'],"+"input[name='PAYMENT_CC_FULL_HOLDER_NAME_2'],"+"input[name='PAYMENT_CC_CUSTOMER_NUMBER_1'], "+"input[name='PAYMENT_CC_CUSTOMER_NUMBER_2']").on("blur",function(){var val=$(this).val();switch($(this).attr("name")){case"PAYMENT_ADDRESS_FIRSTLINE_2":handleMessages(clientMessages["GLBL.regexp.billingInformation.addressOne"],dccSecondErrorMsg["al1"],val,$(this));break;case"PAYMENT_ADDRESS_SECONDLINE_2":handleMessages(clientMessages["GLBL.regexp.billingInformation.addressTwo"],dccSecondErrorMsg["al2"],val,$(this));break;case"PAYMENT_ADDRESS_ZIPCODE_2":handleMessages(clientMessages["GLBL.regexp.billingInformation.PostalCode"],dccSecondErrorMsg["pc"],val,$(this));break;case"PAYMENT_ADDRESS_CITY_2":handleMessages(clientMessages["GLBL.regexp.billingInformation.city"],dccSecondErrorMsg["cn"],val,$(this));break;case"PAYMENT_ADDRESS_STATE_2":handleMessages(clientMessages["GLBL.regexp.billingInformation.State"],dccSecondErrorMsg["s"],val,$(this));break;case"PAYMENT_CC_FULL_HOLDER_NAME_2":handleMessages(clientMessages["GLBL.regexp.billingInformation.cpfName"],dccSecondErrorMsg["cpf"],val,$(this));break;case"PAYMENT_CC_CUSTOMER_NUMBER_2":if(!checkCpf(val)){$(this).addClass("em");currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["f"]);currentMockForm.wdkform("option","errorPanel").errorPanel("addError",null,null,dccSecondErrorMsg["f"]);}else{currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["f"]);$(this).removeClass("em");}break;case"PAYMENT_CC_CUSTOMER_NUMBER_1":if(!checkCpf(val)){$(this).addClass("em");currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["f1"]);currentMockForm.wdkform("option","errorPanel").errorPanel("addError",null,null,dccSecondErrorMsg["f1"]);}else{currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["f1"]);$(this).removeClass("em");}break;}});$("input[name='PAYMENT_ADDRESS_STATE_2']").on("change",function(){var val=$(this).val();currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["s"]);currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["prov2"]);$(this).removeClass("em");handleMessages(clientMessages["GLBL.regexp.billingInformation.State"],dccSecondErrorMsg["s"],val,$(this));});$("select[name='PAYMENT_ADDRESS_STATE_2']").on("change",function(){var val=$(this).val();currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["s"]);currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["prov2"]);$(this).removeClass("em");handleMessages(clientMessages["GLBL.regexp.billingInformation.State"],dccSecondErrorMsg["s"],val,$(this));$(this).selectBox("refresh");});$("input[name='PAYMENT_ADDRESS_STATE_1']").on("change",function(){var val=$(this).val();currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["prov1"]);currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["s1"]);$(this).removeClass("em");handleMessages(clientMessages["GLBL.regexp.billingInformation.State"],dccSecondErrorMsg["prov1"],val,$(this));});$("select[name='PAYMENT_ADDRESS_STATE_1']").on("change",function(){var val=$(this).val();currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["prov1"]);currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["s1"]);$(this).removeClass("em");handleMessages(clientMessages["GLBL.regexp.billingInformation.State"],dccSecondErrorMsg["prov1"],val,$(this));$(this).selectBox("refresh");});$("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_2']").on("change",function(){var val=$(this).val();currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["ctr"]);currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["ctr2"]);currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["prov2"]);currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["s"]);$("select[name='PAYMENT_ADDRESS_STATE_2'], input[name='PAYMENT_ADDRESS_STATE_2']").removeClass("em");$("select[name='PAYMENT_ADDRESS_STATE_2'], input[name='PAYMENT_ADDRESS_STATE_2']").selectBox("refresh");$(this).removeClass("em");if(val==""){handleMessages("^[A-Za-z0-9]{2,25}$",dccSecondErrorMsg["ctr"],val,$(this));}else{handleMessages("^[A-Za-z0-9]{2,25}$",dccSecondErrorMsg["ctr2"],val,$(this));}$(this).selectBox("refresh");});$("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_1'], select[name='PAYMENT_ADDRESS_COUNTRY_1']").on("change",function(){currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["prov1"]);currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg["s1"]);$("select[name='PAYMENT_ADDRESS_STATE_1'], input[name='PAYMENT_ADDRESS_STATE_1']").removeClass("em");$("select[name='PAYMENT_ADDRESS_STATE_1'], input[name='PAYMENT_ADDRESS_STATE_1']").selectBox("refresh");});}function initListeners(){initDccSpecialValidation();searchZipAddressPopin.on("click",function(){cep_search_popin=$("#searchZipAddress");cep_search_popin.dialog({autoOpen:true,draggable:false,width:800,modal:true,resizable:false});var country_preselection=clientSideData["WDS_MARKET_TO_COUNTRY_MAPPING"][clientSideData.WDS_MARKET];$("#dkmc_purf_country option[value='"+country_preselection+"']").attr("selected","selected");$("#dkmc_purf_country").selectBox("refresh");$('select[name="DKMC_PAYMENT_ADDRESS_COUNTRY_CODE_1"]').selectBox("destroy").selectBox();cep_search_popin.find("#SEARCH_CEP_FORM").wdkform("option","errorPanel").errorPanel("reset");cep_search_popin.find("#SEARCH_CEP_FORM")[0].reset();initCepSearchStateField();return false;});$("#searchAddressFromCep").on("click",function(event){clearCEPFields(1);var zipcodeSearchWarningPanel=$(currentCEPMop).find(".zipcode_pageWarning");$(zipcodeSearchWarningPanel).errorPanel();$(zipcodeSearchWarningPanel).errorPanel("reset");event.preventDefault();$("#cep_rslt_table > tbody:last > tr:not(:first)").remove();var cepSearchPageError=$("#cep_search_pageError");var cepSearchRsltPageWarning=$("#cep_search_rslt_pageWarning");var cepSearchRsltPageError=$("#cep_search_rslt_pageError");cepSearchPageError.errorPanel();cepSearchRsltPageWarning.errorPanel();cepSearchPageError.errorPanel();cepSearchPageError.errorPanel("reset");cepSearchRsltPageWarning.errorPanel("reset");cepSearchRsltPageError.errorPanel("reset");var cep_search_form=wdk.form("SEARCH_CEP_FORM",{errorPanel:$("#cep_search_pageError"),ajaxSubmit:true,ajaxOptions:{dataType:"json",success:function(data){var hasError=false;if(data.mapDataUI.LIST_MSG!=null&&data.mapDataUI.LIST_MSG!="undefined"&&data.mapDataUI.LIST_MSG.length>0){for(var i=0;i<data.mapDataUI.LIST_MSG.length;i++){var error=data.mapDataUI.LIST_MSG[i];if(error.TYPE=="E"){hasError=true;cepSearchPageError.errorPanel("addError",null,null,error.TEXT);}else{cepSearchRsltPageWarning.errorPanel("addError",null,null,error.TEXT);}}}if(hasError){handleErrorSearchZipAddress(cepSearchPageError,true);handleErrorSearchZipAddressMaxFail(data.mapDataUI.LIST_MSG);}else{var resp=[];$.each(data.mapDataUI.ADDRESSES,function(index,value){resp.push(value);});if(resp.length==0){maxZipAddressSearchFailed[currentMop]++;if(maxZipAddressSearchFailed[currentMop]<cep_search_max_fail){cepSearchPageError.errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.NoRecordFound"]);return false;}else{hideCepSearch();setDisabled(false,1);cep_search_popin.dialog("close");handleErrorSearchZipAddressMaxFail(data.mapDataUI.LIST_MSG);return false;}}var tableTemplateData={"addresses":resp,"PAGECODE_text_SearchZipAddressSearchRsltSelect":clientMessages[clientSideData.PAGE_CODE+".text.SearchZipAddressSearchRsltSelect"]};var tableTemplate=$(tamUtils.getElementForTmpls($("#views_air_booking_panels_purf_cep_rslt_template").tmpl(tableTemplateData)));$("#cep_rslt_table tr:last").after(tableTemplate);cep_search_popin.dialog("close");cep_search_rslt_popin=$("#cep_rslt");cep_search_rslt_popin.data("dataMap",data);cep_search_rslt_popin.dialog({autoOpen:true,draggable:false,width:800,modal:true,resizable:false});}return false;},error:function(data){handleErrorSearchZipAddress(cepSearchPageError,false);handleErrorSearchZipAddressMaxFail(data.mapDataUI.LIST_MSG);},prepareSubmit:function(){}},check:function(){var a=this.find("#purfStateSpan a");if(a.find(".selectBox-label").text()==""){a.addClass("em");return false;}}});cep_search_form.submit();});function handleErrorSearchZipAddress(cepSearchPageError,isErrorFromWS){maxZipAddressSearchFailed[currentMop]++;if(maxZipAddressSearchFailed[currentMop]>=cep_search_max_fail){hideCepSearch();setDisabled(false,1);cep_search_popin.dialog("close");}else{if(!isErrorFromWS){cepSearchPageError.errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.WebServiceError"]);}}}function handleErrorSearchZipAddressMaxFail(errorData){if(maxZipAddressSearchFailed[currentMop]>=cep_search_max_fail){var zipcodeSearchErrorPanel=$(currentCEPMop).find(".zipcode_pageError");var zipcodeSearchWarningPanel=$(currentCEPMop).find(".zipcode_pageWarning");resetZipCodeSearchErrorPanel(zipcodeSearchErrorPanel,zipcodeSearchWarningPanel);if(errorData!=null||errorData!=undefined){for(var i=0;i<errorData.length;i++){var error=errorData[i];if(error.TYPE=="E"){$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,error.TEXT);}else{$(zipcodeSearchWarningPanel).errorPanel("addError",null,null,error.TEXT);}}}$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,clientMessages["ALLP.error.CEPErrorEnterManually"]);$("<input>").attr("type","hidden").attr("name","ZIPCODE_MANUAL_ENTRY_ALLFIELDS").attr("value","true").appendTo(currentMockForm);$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+i+"']").attr("maxLength","50");$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+i+"']").attr("data-wdk-validate-regexp-error",clientMessages[clientSideData.PAGE_CODE+".error.WrongAddress"]);$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+i+"']").attr("data-wdk-validate-regexp",clientMessages["GLBL.regexp.billingInformation.addressOne"]);}}$("#cep_rslt_back").on("click",function(event){cep_search_popin.dialog("open");cep_search_rslt_popin.dialog("close");});$("#no_cep_rslt").on("click",function(event){setDisabled(false,1);noZipAddressMatched=true;var zipcodeSearchWarningPanel=$(currentCEPMop).find(".zipcode_pageWarning");$(zipcodeSearchWarningPanel).errorPanel();$(zipcodeSearchWarningPanel).errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.EnterBillingAddressManually"]);cep_search_rslt_popin.dialog("close");});$(document).on("click",".select_cep_rslt",function(event){var data=cep_search_rslt_popin.data("dataMap");var zipCode=$(this).data("zipcode");handleSuccessfulAddressSearchFromCEP(data.mapDataUI.ADDRESSES[zipCode]);setDisabled(true,1);cep_search_rslt_popin.dialog("close");});installmentsPopin.on("click",function(){var x=[];x[x.length]={"data":installmentsInformation[installmentSelected].DETAILS,"installmentPlan":clientMessages[clientSideData["PAGE_CODE"]+".text.InstallmentPlan"],"yourPlan":clientMessages[clientSideData["PAGE_CODE"]+".text.YourInstallmentPlan"],"total":clientMessages[clientSideData["PAGE_CODE"]+".text.Total"],"plan":clientMessages[clientSideData["PAGE_CODE"]+".text.Plan"],"downpayment":clientMessages[clientSideData["PAGE_CODE"]+".text.Downpayment"],"installments":clientMessages[clientSideData["PAGE_CODE"]+".text.Installments"],"interests":clientMessages[clientSideData["PAGE_CODE"]+".text.Interests"]};var popin=$(tamUtils.getElementForTmpls(template_installmentsPopin.template.tmpl(x)));popin.dialog({autoOpen:true,draggable:false,width:640,modal:true,resizable:false});return false;});insuranceInput.click(function(){if($(this).value()=="true"){$(document).trigger("addInsurance",{amount:clientSideData["WDS_INSURANCE_PRICE"]});currentMockForm.input("WDS_INSURANCE").value("TRUE");checkInsParam(true);}else{showInsPopin();currentMockForm.input("WDS_INSURANCE").value("FALSE");checkInsParam(false);}});$("input#card_owner_profile_checkbox").on("change",function(){if($(this).attr("checked")){$("input#cpfFirstName").prop("disabled",true).addClass("cep-input");$("input#cpfLastName").prop("disabled",true).addClass("cep-input");$("input#cpf").prop("disabled",true).addClass("cep-input");$("select#cpfBirthDay").prop("disabled",true).addClass("selectBox-label cep-input").selectBox("refresh");$("select#cpfBirthMonth").prop("disabled",true).addClass("selectBox-label cep-input").selectBox("refresh");$("select#cpfBirthYear").prop("disabled",true).addClass("selectBox-label cep-input").selectBox("refresh");$("input#cpfFirstName").val(clientSideData.PROFILE.firstName);$("input#cpfLastName").val(clientSideData.PROFILE.lastName);$("input#cpf").val(clientSideData.PROFILE.cpf);var profile_dob=clientSideData.PROFILE.dateOfBirth;var check_dob=Date.parse(profile_dob);if(isNaN(check_dob)){var dob=new Date(profile_dob);dob=new Date(dob.getTime()+dob.getTimezoneOffset()*60000);var day=dob.getDate();day=day<10?"0"+day:day;var month=dob.getMonth();month=(month+1)<10?"0"+(month+1):(month+1);var year=dob.getFullYear();$("select#cpfBirthDay").val(day).selectBox("refresh");$("select#cpfBirthMonth").val(month).selectBox("refresh");$("select#cpfBirthYear").val(year).selectBox("refresh");}}else{$("input#cpfFirstName").prop("disabled",false).removeClass("cep-input");$("input#cpfLastName").prop("disabled",false).removeClass("cep-input");$("input#cpf").prop("disabled",false).removeClass("cep-input");$("select#cpfBirthDay").prop("disabled",false).removeClass("selectBox-label cep-input").selectBox("refresh");$("select#cpfBirthMonth").prop("disabled",false).removeClass("selectBox-label cep-input").selectBox("refresh");$("select#cpfBirthYear").prop("disabled",false).removeClass("selectBox-label cep-input").selectBox("refresh");$("input#cpfFirstName").val("");$("input#cpfLastName").val("");$("input#cpf").val("");$("select#cpfBirthDay").prop("selectedIndex",0).selectBox("refresh");$("select#cpfBirthMonth").prop("selectedIndex",0).selectBox("refresh");$("select#cpfBirthYear").prop("selectedIndex",0).selectBox("refresh");}});$("input[name='PAYMENT_ADDRESS_NUMBER_1']").on("change",function(){if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){handleRegexCheckForPlaceHolderFields($(currentCEPMop).find("input[name='PAYMENT_ADDRESS_NUMBER_1']"),clientMessages["GLBL.regexp.billingInformation.AddressNumber"],clientMessages[clientSideData.PAGE_CODE+".error.WrongAddressNumber"],false);}});$("input[name='PAYMENT_ADDRESS_SECONDLINE_1']").on("change",function(){handleRegexCheckForPlaceHolderFields($(currentCEPMop).find("input[name='PAYMENT_ADDRESS_SECONDLINE_1']"),clientMessages["GLBL.regexp.billingInformation.addressTwo"],clientMessages[clientSideData.PAGE_CODE+".error.WrongAddressLine2"],false);});$("input[name='PAYMENT_ADDRESS_ZIPCODE_1']").on("change",function(){if(clientSideData.CEP_LOOKUP_ENABLED&&(currentMop=="TAMCreditCard"||currentMop=="CreditCard")){clearCEPFields(1);}});if(clientSideData.CEP_LOOKUP_ENABLED&&(clientSideData.WDS_MARKET=="BR"||clientSideData.WDS_MARKET=="CO")){var cep=$("input[name='PAYMENT_ADDRESS_ZIPCODE_1']");cep.unbind("keyup keydown keypress");cep.unmask();cep.mask(clientMessages["GLBL.text.CepMask"]);}$("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_1']").on("change",function(){if(clientSideData.CEP_LOOKUP_ENABLED){var cep=$("input[name='PAYMENT_ADDRESS_ZIPCODE_1']");cep.unbind("keyup keydown keypress");if($("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_1']").val()!="BR"){cep.unbind();cep.val(cep.val().replace("-","").replace("_","").trim());}else{cep.unmask();cep.mask(clientMessages["GLBL.text.CepMask"]);}}});$(".find_address_of_CEP").on("click",function(event){if(clientSideData.CEP_LOOKUP_ENABLED&&!(maxCEPLookupFailed[currentMop]>=cep_search_max_fail)){event.preventDefault();var cepFieldValue=$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_ZIPCODE_1']").val();$(currentCEPMop).find("input[name='SELECTED_ZIPCODE']").val(cepFieldValue);clearCEPFields(1);setDisabled(!isCEPLookupMaxFailReached(),1);var i=1;var zipcodeSearchErrorPanel=$(currentCEPMop).find(".zipcode_pageError");var zipcodeSearchWarningPanel=$(currentCEPMop).find(".zipcode_pageWarning");resetZipCodeSearchErrorPanel(zipcodeSearchErrorPanel,zipcodeSearchWarningPanel);var cepAfterRemovingMasking=cepFieldValue.replace("-","").replace("_","").trim();if(cepAfterRemovingMasking.length<1){$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterPostCode"]);return;}var zipCodeMandatory=$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_ZIPCODE_"+i+"']").check(wdk.validations.mandatory,clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterPostCode"],{"avoidAddingToPanel":true});if(!zipCodeMandatory){$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterPostCode"]);return;}var zipCodeValidRegEx=true;if((clientSideData.WDS_MARKET=="BR"||clientSideData.WDS_MARKET=="CO")&&$("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_1']").val()=="BR"){zipCodeValidRegEx=$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_ZIPCODE_"+i+"']").check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.CEPFormatError"],{},clientMessages["GLBL.regexp.billingInformation.CEPPattern"],{"avoidAddingToPanel":true});if(!zipCodeValidRegEx){$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.CEPFormatError"]);return;}}else{zipCodeValidRegEx=$(currentCEPMop).find("input[name='PAYMENT_ADDRESS_ZIPCODE_"+i+"']").check(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.WrongPostalCode"],{},clientMessages["GLBL.regexp.billingInformation.PostalCodeNumbersOnly"],{"avoidAddingToPanel":true});if(!zipCodeValidRegEx){$(zipcodeSearchErrorPanel).errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.WrongPostalCode"]);return;}}var zipCodeToGet=$(currentCEPMop).find("input[name='SELECTED_ZIPCODE']");var zipCodeToSend=zipCodeToGet.val().replace("-","");var parameters={"WDS_MARKET":clientSideData.WDS_MARKET,"SITE":clientSideData.SITE,"LANGUAGE":clientSideData.LANGUAGE,"CEP_NUMBER":zipCodeToSend,"COUNTRY_CODE":$(currentCEPMop).find("select[name='PAYMENT_ADDRESS_COUNTRY_CODE_"+i+"']").val()};$.ajax({url:encodeUrl("/TAM/dyn/air/booking/lookupAddressFromCep"),data:parameters,type:"GET",dataType:"json",async:"false",success:function(data){handleErrorWithZipCodeService(data.mapDataUI.LIST_MSG);if(data.mapDataUI.ADDRESS!=undefined){handleSuccessfulAddressSearchFromCEP(data.mapDataUI.ADDRESS);}},error:function(data){handleErrorWithZipCodeService(data.mapDataUI.LIST_MSG);}});}});$("#buyIns").on("click",function(){$("#add-insurance").prop("checked",true);$(document).trigger("addInsurance",{amount:clientSideData["WDS_INSURANCE_PRICE"]});currentMockForm.input("WDS_INSURANCE").value("TRUE");checkInsParam(true);$(".ui-dialog").find(".ui-dialog-titlebar-close").click();submitHoldForInsPopin=false;});$("#resignIns").on("click",function(){$("#no-insurance").prop("checked",true);$(document).trigger("removeInsurance");currentMockForm.input("WDS_INSURANCE").value("FALSE");checkInsParam(false);$(".ui-dialog").find(".ui-dialog-titlebar-close").click();if(submitHoldForInsPopin){submitHoldForInsPopin=false;$.blockUI();window.setTimeout(function(){currentMockForm.submit();},700);}});$("[id^='purf_country']").on("change",function(){$(this).selectBox("destroy").selectBox();var clickedCcId=$(this).attr("id").split("_");initStateField(clickedCcId[2]);if($("#billing_adress:checkbox:checked").length==0){if(clickedCcId[2]==1){$("[name='PAYMENT_ADDRESS_COUNTRY_CODE_2']").find("option[value='"+$("[name='PAYMENT_ADDRESS_COUNTRY_CODE_1']").val()+"']").attr("selected","selected");initStateField(2);}}});$("#dkmc_purf_country").on("change",function(){$(this).selectBox("destroy").selectBox();initCepSearchStateField();});$(".moreInfo1").on("click",function(){if($("#moreInfo1").length>0){$("#moreInfo1").dialog({autoOpen:true,draggable:false,width:640,modal:true,resizable:false});}});$(".moreInfo2").on("click",function(){if($("#moreInfo2").length>0){$("#moreInfo2").dialog({autoOpen:true,draggable:false,width:640,modal:true,resizable:false});}});$(".doubleCC input[name='firstCCAmount']").on("blur",function(){$(".doubleCC input[name='PAYMENT_GROUP_1_LIST_PAYMENT_1_AMOUNT']").val($(this).unmask().replace(" ","")/100);var ccOne=$(".doubleCC input[name='PAYMENT_CC_NUMBER_1']");var ccTwo=$(".doubleCC input[name='PAYMENT_CC_NUMBER_2']");if(ccOne.val()!=""){ccOne.trigger("blur");}if(ccTwo.val()!=""){ccTwo.trigger("blur");}});installmentsSelect.on("change",function(){var ccId=$(this).parents(".doubleCC").data("ccid");if(typeof ccId!=="undefined"){currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",currentMockForm.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+ccId+"_INSTALLMENT_PLAN_ID"),null,clientMessages[clientSideData.PAGE_CODE+".text.PleaseSelectYourInstallmentPlan"]);currentMockForm.input("PAYMENT_GROUP_1_LIST_PAYMENT_"+ccId+"_INSTALLMENT_PLAN_ID").removeClass("em").selectBox("destroy").selectBox();}else{currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",currentMockForm.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID"),null,clientMessages[clientSideData.PAGE_CODE+".text.PleaseSelectYourInstallmentPlan"]);currentMockForm.input("PAYMENT_GROUP_1_LIST_PAYMENT_1_INSTALLMENT_PLAN_ID").removeClass("em").selectBox("destroy").selectBox();}if($(this).val()!="0"&&$(this).val()!="-1"){$(document).trigger("addInstallments",{amount:$(this).find("option:selected").data("fees"),link:"#"});}else{$(document).trigger("removeInstallments");}if($(this).val()!="-1"){$("#installmentsContainer").qtip({content:$("#installmentsContainer select option:selected").text(),position:{target:"event",effect:false,viewport:$(window),my:"bottom center",at:"top center",adjust:{method:"none shift"}},style:{tip:{width:23,height:13},width:240}});}else{$("#installmentsContainer").qtip("destroy");}installmentSelected=$(this).val();});providers.on("click",function(){var provider=$(this);var ccId=provider.parents(".doubleCC").data("ccid")||1;if(ccId==1){currentProvider=provider.data("name");}else{currentProvider2=provider.data("name");}provider.parents("ul").find(".selected").removeClass("selected").addClass("caption");provider.removeClass("caption").addClass("selected");var divSet=provider.parents("div").eq(0);var config=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider];if(ccId==2){config=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider2];}if(currentMop=="DebitCard"&&typeof config!=="undefined"&&typeof config.CVC_REQ!=="undefined"){updateDebditCardCvc(divSet,config,"PAYMENT_CC_DIGIT_CODE_"+ccId);}if(typeof config!=="undefined"&&typeof config.IS_CVC!=="undefined"){$(this).parents("form").eq(0).input("PAYMENT_CC_TYPE_"+ccId).value(provider.data("code"));currentMockForm.input("PAYMENT_CC_NUMBER_"+ccId).value("");applyCCLimits(divSet,config,"PAYMENT_CC_NUMBER_"+ccId);toggleCvc(divSet,config,"PAYMENT_CC_DIGIT_CODE_"+ccId);if(config.IS_CVC==true){applyCVCLimits(divSet,config,"PAYMENT_CC_DIGIT_CODE_"+ccId);}if(config.IS_CVC==true){changeCVCIcon(divSet,config);}}if(typeof ccId!=="undefined"){provider.parents("form").eq(0).input("WDS_PROVIDER_"+ccId).value(provider.data("code"));provider.parents("form").eq(0).input("WDS_PROVIDER_NAME_"+ccId).value(provider.data("name"));}else{provider.parents("form").eq(0).input("WDS_PROVIDER_1").value(provider.data("code"));provider.parents("form").eq(0).input("WDS_PROVIDER_NAME_1").value(provider.data("name"));}var currentMopEl=$("#mopsLeftPanel label.block.boxw.active");var providerList=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_LIST;var isInsuranceForDCC="DoubleCreditCard"!==currentMop;if(clientSideData.WDS_DOUBLECC_ENABLE_INSURANCE){isInsuranceForDCC=true;}if(typeof providerList!="undefined"&&providerList.length==1&&!currentMopEl.hasClass("inactive")){$("#insuranceHeader, #insuranceArticle").hide("slow");}else{if(provider.data("insurance")===true&&typeof(ccId)!=="undefined"&&ccId==1&&isInsuranceForDCC){$("#insuranceHeader,#insuranceArticle").show("slow");if($("#add-insurance").prop("checked")){$(document).trigger("addInsurance",{amount:clientSideData["WDS_INSURANCE_PRICE"]});currentMockForm.input("WDS_INSURANCE").value("TRUE");checkInsParam(true);}}else{if(!(typeof(ccId)!=="undefined"&&ccId==2)){$(document).trigger("removeInsurance");currentMockForm.input("WDS_INSURANCE").value("FALSE");checkInsParam(false);$("#insuranceHeader,#insuranceArticle").hide("slow");}}}if(typeof ccId!=="undefined"){clearInstallments(ccId);}else{clearInstallments();}});mops.on("click",function(ev){currentMop=$(this).parent().data("mopname");currentMockForm=mockForms[$(this).parent().attr("id").split("d")[1]];currentMockForm.wdkform("option","errorPanel").errorPanel("reset");installmentsContainer=currentMockForm.find("span[id='installmentsContainer']");changeTab($(this).parent(),currentMockForm,currentMop);checkProviderSelection(currentMop);currentMockForm.input("WDS_MOP").value($(this).parent().data("code"));var providerList=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_LIST;if(providerList.length==1&&!$(this).parent().hasClass("inactive")){currentMockForm.input("WDS_PROVIDER_1").value(clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[providerList[0]].CODE);currentMockForm.input("WDS_PROVIDER_NAME_1").value(clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[providerList[0]].NAME);var activeMopDiv=$(".mop_"+currentMop);var selectedProvider;if(activeMopDiv.find("ul li.selected").length){selectedProvider=activeMopDiv.find("ul li.selected").eq(0);}else{selectedProvider=activeMopDiv.find("ul li").eq(0);}if(selectedProvider.data("insurance")==undefined){$("#insuranceHeader, #insuranceArticle").hide("slow");}}clearInstallments("all");if(($(this).parent().data("code")!="CC"&&$(this).parent().data("code")!="DCC")||(($(this).parent().data("code")=="CC"||$(this).parent().data("code")=="DCC")&&$("#no-insurance").prop("checked"))){$(document).trigger("removeInsurance");currentMockForm.input("WDS_INSURANCE").value("FALSE");checkInsParam(false);}else{if($("#add-insurance").prop("checked")){$(document).trigger("addInsurance",{amount:clientSideData["WDS_INSURANCE_PRICE"]});currentMockForm.input("WDS_INSURANCE").value("TRUE");checkInsParam(true);}}});if(clientSideData.WDS_XHR_INSTALLMENTS){$(".mop_TAMCreditCard input[name='PAYMENT_CC_NUMBER_1'], .mop_CreditCard input[name='PAYMENT_CC_NUMBER_1']").on("blur",function(){var ccId=1;$("input[name='AIR_CC_NUMBER']").on("blur",function(){if(!checkLuhn($(this).val(),ccId)||!checkCcPrefix($(this).val(),ccId)||!checkCcLength($(this).val())){$(this).addClass("em");}else{$(this).removeClass("em");}});if(!$(this).hasClass("em")&&$(this).val()!=""){installmentsForm.input("CC_ID").value(ccId);installmentsForm.input("CC_NUMBER").value($(this).value());var ccProvider=$("ul li.selected",$(this).parents("div.singleCC")).data("code");installmentsForm.input("CC_TYPE").value(ccProvider);installmentsForm.find("input[name='AMOUNT']").prop("disabled",true);$.blockUI();installmentsContainer=currentMockForm.find("div[id='sectionInstallments'] span[id='installmentsContainer']");installmentsForm.submit();installmentsCallMade=true;}else{currentMockForm.find("div[id='sectionInstallments']").addClass("none");}});}if(clientSideData.WDS_DOUBLECC_MARKETS_WITH_INSTALLMENTS){lock=false;function callInstallmentsXhr(ccId,elem){if(!$(elem).hasClass("em")&&$(elem).val()!=""){installmentsForm.input("CC_ID").value(ccId);installmentsForm.input("CC_NUMBER").value($(elem).val());var ccProvider=$("ul li.selected",$(elem).parents("div.doubleCC")).data("code");installmentsForm.input("CC_TYPE").value(ccProvider);installmentsForm.find("input[name='AMOUNT']").prop("disabled",false);installmentsForm.input("AMOUNT").value(getCCAmount($(elem).parents("div.doubleCC").data("ccid")));$.blockUI();installmentsContainer=currentMockForm.find("div[id='doubleCCInstallments"+ccId+"'] span[id='installmentsContainer']");installmentsForm.submit();installmentsCallMade=true;}else{currentMockForm.find("div[id='doubleCCInstallments"+ccId+"']").addClass("none");lock=false;}}var xhrQueue=[];$(document).on("xhr_push",function(ev,data){xhrQueue.push(data);$(document).trigger("xhr_pop");});$(document).on("xhr_pop",function(){if(xhrQueue.length>0&&lock==false){lock=true;var obj=xhrQueue.pop();callInstallmentsXhr(obj.ccId,obj.elem);}});$(".mop_DoubleCreditCard input[name='PAYMENT_CC_NUMBER_1'], .mop_DoubleCreditCard input[name='PAYMENT_CC_NUMBER_2']").on("blur",function(){var ccId=1;if(typeof($(this).attr("name"))!=="undefined"&&$(this).attr("name")=="PAYMENT_CC_NUMBER_2"){ccId=2;}var self=this;$(document).trigger("xhr_push",[{ccId:ccId,elem:self}]);});}$(".main .right, #nextButton").not("#resignIns, #buyIns, #searchZipAddress, #searchAddressFromCep").on("click",function(){if(typeof(currentMockForm.parent("div").attr("id"))!=="undefined"&&!$("#"+currentMockForm.parent("div").attr("id").split("target_")[1]).hasClass("inactive")){if($("#insuranceHeader").filter(":visible").length){if((typeof insuranceInput.value()=="undefined")&&(!insuranceInput.is(":hidden"))){submitHoldForInsPopin=true;showInsPopin();}else{if("FSRS"===clientSideData.PAGE_CODE){theSeatPanel.chargeableSeatsTermsAndConditionsPopin(function(){$.blockUI();window.setTimeout(function(){currentMockForm.submit();},700);});}else{$.blockUI();window.setTimeout(function(){currentMockForm.submit();},700);}}}else{if("FSRS"===clientSideData.PAGE_CODE){theSeatPanel.chargeableSeatsTermsAndConditionsPopin(function(){checkInsParam(false);$.blockUI();window.setTimeout(function(){currentMockForm.submit();},700);});}else{checkInsParam(false);$.blockUI();window.setTimeout(function(){currentMockForm.submit();},700);}}}});$(".mop_DoubleCreditCard label[for=billing_adress]").click(function(){toggle($(this),$(".mop_DoubleCreditCard #billing_panel"));});$(".mop_DoubleCreditCard label[for=security_adress]").click(function(){toggle($(this),$(".mop_DoubleCreditCard #security_panel"));});$("input[name=cc-issuance]").on("click",function(){var infoPPAL=$("#infoPPALCCIssuance");if($(this).val()=="BR"){infoPPAL.removeClass("none");}else{if(!infoPPAL.hasClass("none")){infoPPAL.addClass("none");}}});}function getCCAmount(ccId,firstAmount){var firstCCAmount=$(".doubleCC input[name='PAYMENT_GROUP_1_LIST_PAYMENT_1_AMOUNT']").val();if(firstCCAmount==null||typeof firstCCAmount==="undefined"||firstCCAmount==""){firstCCAmount=0;}if(typeof(firstAmount)!=="undefined"){firstCCAmount=firstAmount;}if(ccId==2&&typeof rpModel!=="undefined"&&typeof rpModel.totals!=="undefined"&&typeof rpModel.totals.grandTotal!=="undefined"&&typeof rpModel.totals.grandTotal.amount!=="undefined"){return rpModel.totals.grandTotal.amount.toFixed(2)-firstCCAmount;}return firstCCAmount;}function toggle(obj,target){if(obj.find("input:checked").length>0){target.removeClass("none");}else{target.addClass("none");target.find("input").removeClass("em").val("");for(var key in dccSecondErrorMsg){currentMockForm.wdkform("option","errorPanel").errorPanel("removeError",null,null,dccSecondErrorMsg[key]);}}}function checkCpf(number){var cpfMinMaxLimits=clientMessages["GLBL.list.CPFMinMax"];var cpfLimitsPerCard=cpfMinMaxLimits.split("|");var cardLimits={};for(var i=0;i<cpfLimitsPerCard.length;i++){cardLimits[cpfLimitsPerCard[i].split(":")[0]]=cpfLimitsPerCard[i].split(":")[1];}if(!/^[0-9\-\.]+$/.test(number)){return false;}var limitsArray=cardLimits[clientSideData.WDS_MARKET].split(",");var cpfMinLength=~~(limitsArray[0]);var cpfMaxLength=~~(limitsArray[1]);var strippedCpf=number.replace(/[\.\-]/g,"");var cpfLength=strippedCpf.length;if((cpfLength<cpfMinLength||cpfLength>cpfMaxLength)||!number.match(/^[0-9\-\.]{1,14}/)){return false;}if("BR"==clientSideData.WDS_MARKET&&11==cpfLength){return theUtils.validateCPF(strippedCpf);}return true;}function checkCvcMandatory(val,ccId){var isCvc=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider].IS_CVC;if(ccId==2){isCvc=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider2].IS_CVC;}if(val!=""&&isCvc){return true;}return false;}function checkAddrStreetRegex(val){var pattern=new RegExp(clientMessages["GLBL.regexp.billingInformation.addressOne"]);if(""!=val&&pattern.test(val)){return true;}return false;}function checkCpfDOB(day,month,year){var cpfDob=new Date(year,(month)-1,day);var today=new Date();if(cpfDob>=today){return false;}return true;}function checkLuhn(number,ccId){var isLuhn=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider].IS_LUHN;if(ccId==2){isLuhn=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider2].IS_LUHN;}if(isLuhn){return wdk.validations.luhn(number);}return true;}function checkCCDates(month,year){$(month).selectBox("control").removeClass("em");$(year).selectBox("control").removeClass("em");var selectedDate=new Date();var currentDate=new Date();selectedDate.setDate("1");selectedDate.setYear(year.val());selectedDate.setMonth(month.val()-1);if(selectedDate.getFullYear()>currentDate.getFullYear()){return true;}else{if(selectedDate.getMonth()<currentDate.getMonth()){$(month).selectBox("control").addClass("em");return false;}}return true;}function checkCcPrefix(number,ccId){var allowedPrefixes=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider].CCPREFIXES;if(ccId==2){allowedPrefixes=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider2].CCPREFIXES;}var prefixesArr=allowedPrefixes.split(",");for(var i=0;i<prefixesArr.length;i++){var prefix=prefixesArr[i];if(number.indexOf(prefix)==0){return true;}}return false;}function checkDebitCardCvc(number){var cvcReq=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider].CVC_REQ;var cvcMaxLength=Math.max.apply(Math,clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider].CVC_MAX_LENGTH.split(","));var cvcMinLength=(cvcReq=="MANDATORY")?cvcMaxLength:0;var cvcRegExp="^([0-9]{"+cvcMaxLength+"})$";if(cvcReq=="OPTIONAL"){cvcRegExp="^([0-9]{"+cvcMaxLength+"})?$";}if(new RegExp(cvcRegExp).test(number)&&number.length<=cvcMaxLength&&number.length>=cvcMinLength){return true;}return false;}function checkCcLength(number){var allowedPrefixes=clientSideData.MOP_SETTINGS.MOPS[currentMop].PROVIDER_MAP[currentProvider].CCLENGTH;var lengthAllowed=allowedPrefixes.split(",");var numberLength=number.length;if(lengthAllowed.length==2){if(numberLength<lengthAllowed[0]||numberLength>lengthAllowed[1]){return false;}}else{if(numberLength!=lengthAllowed[0]){return false;}}return true;}function initValidators(){for(var i=0;i<mopsLength;i++){if(typeof mockForms[i]!=="undefined"){mockForms[i].input("PAYMENT_CC_DIGIT_CODE_1").attachCheck(wdk.validations.regexp,clientMessages[clientSideData.PAGE_CODE+".error.NeedToEnterCVC"],{"avoidAddingToPanel":false});mockForms[i].input("PAYMENT_CC_NUMBER_1").attachCheck(function(val){return checkCcPrefix(val,1);},clientMessages[clientSideData.PAGE_CODE+".error.WrongPrefixForSelectedVendor"],{"avoidAddingToPanel":false});mockForms[i].input("PAYMENT_CC_NUMBER_1").attachCheck(function(val){return checkLuhn(val,1);},clientMessages[clientSideData.PAGE_CODE+".error.CardNumberNotValidWithLUHN"],{"avoidAddingToPanel":false});mockForms[i].input("PAYMENT_CC_NUMBER_1").attachCheck(function(val){return checkCcLength(val);},clientMessages[clientSideData.PAGE_CODE+".error.WrongCardNumberLength"],{"avoidAddingToPanel":false});mockForms[i].input("PAYMENT_CC_CUSTOMER_NUMBER_1").attachCheck(function(val){return(""==val)||checkCpf(val);},clientMessages[clientSideData.PAGE_CODE+".error.CpfNumberWrongFormat"],{"avoidAddingToPanel":false});mockForms[i].input("WDS_EXPIRY_MONTH_1").add(mockForms[i].input("WDS_EXPIRY_YEAR_1")).attachCheck(function(val){var month=$(this).parent().parent().find("[name='WDS_EXPIRY_MONTH_1']");var year=$(this).parent().parent().find("[name='WDS_EXPIRY_YEAR_1']");return checkCCDates(month,year);},clientMessages[clientSideData.PAGE_CODE+".error.ExpiryDateIsIncorrect"],{"avoidAddingToPanel":false});if(mockForms[i].find(".singleDC").length>0){mockForms[i].input("PAYMENT_CC_DIGIT_CODE_1").attachCheck(function(val){return checkDebitCardCvc(val);},clientMessages[clientSideData.PAGE_CODE+".error.WrongLengthOfCVCCodeForSelectedCardType"],{"avoidAddingToPanel":false});}mockForms[i].input("PAYMENT_CC_NUMBER_2").attachCheck(function(val){return checkCcPrefix(val,2);},clientMessages[clientSideData.PAGE_CODE+".error.WrongPrefixForSelectedVendor"],{"avoidAddingToPanel":false});mockForms[i].input("PAYMENT_CC_NUMBER_2").attachCheck(function(val){return checkLuhn(val,2);},clientMessages[clientSideData.PAGE_CODE+".error.CardNumberNotValidWithLUHN"],{"avoidAddingToPanel":false});if(mockForms[i].input("PAYMENT_CC_DIGIT_CODE_2").length>0){mockForms[i].input("WDS_EXPIRY_MONTH_2").add(mockForms[i].input("WDS_EXPIRY_YEAR_2")).attachCheck(function(val){var month=$(this).parent().parent().find("[name='WDS_EXPIRY_MONTH_2']");var year=$(this).parent().parent().find("[name='WDS_EXPIRY_YEAR_2']");return checkCCDates(month,year);},clientMessages[clientSideData.PAGE_CODE+".error.ExpiryDateIsIncorrect2"],{"avoidAddingToPanel":false});}}}}function preselectMop(){if(savedData!=null){$("label[data-mopname='"+savedData["MOP"]+"'] input").click();var activeMopDiv=$(".mop_"+savedData["MOP"]);if(savedData["MOP"]=="DoubleCreditCard"){activeMopDiv.find(".doubleCC").eq(0).find("ul li[data-name='"+savedData["PROVIDER_1"]+"']").click();activeMopDiv.find(".doubleCC").eq(1).find("ul li[data-name='"+savedData["PROVIDER_2"]+"']").click();}else{activeMopDiv.find("ul li[data-name='"+savedData["PROVIDER"]+"']").click();}}else{$("label[data-mopname='"+clientSideData.MOP_SETTINGS.DEFAULT_MOP+"'] input").click();}}function prefillBillingInformation(){if(savedData!=null&&savedData["MOP"]!=null&&savedData["MOP"].length&&$("input[name='PAYMENT_ADDRESS_FIRSTLINE_1']").length){for(var i=1;i<3;i++){if(savedData["BILLING_"+i]!=null&&$("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+i+"']").length){$("input[name='PAYMENT_ADDRESS_FIRSTLINE_"+i+"']").val(savedData["BILLING_"+i]["LINE_ONE"]);$("input[name='PAYMENT_ADDRESS_SECONDLINE_"+i+"']").val(savedData["BILLING_"+i]["LINE_TWO"]);$("input[name='PAYMENT_ADDRESS_ZIPCODE_"+i+"']").val(savedData["BILLING_"+i]["POSTAL_CODE"]);$("input[name='PAYMENT_ADDRESS_CITY_"+i+"']").val(savedData["BILLING_"+i]["CITY"]);$("[name='PAYMENT_ADDRESS_STATE_"+i+"']").val(savedData["BILLING_"+i]["STATE"]);$("[name='PAYMENT_ADDRESS_COUNTRY_CODE_"+i+"']").val(savedData["BILLING_"+i]["COUNTRY"]);}}}}function initListenersExtp(){var extp=wdk.form("EXTP",{errorPanel:$("#pageError"),check:function(){if(typeof $("input[name='WDS_ACCEPT_TERMS']").value()==="undefined"){this.wdkform("option","errorPanel").errorPanel("removeError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.MessageReadConditions"]);this.wdkform("option","errorPanel").errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.MessageReadConditions"]);return false;}else{this.wdkform("option","errorPanel").errorPanel("removeError",null,null,clientMessages[clientSideData.PAGE_CODE+".error.MessageReadConditions"]);}}});$("#nextButton").on("click",function(){$.blockUI();window.setTimeout(function(){extp.submit();},700);});}function initKeyNavigation(){$(document).bind("keydown",function(ev){if($("input[name=radio2]:checked:focus").length){var currentList=$("#target_"+$("input[name=radio2]:checked").parent().attr("id")+" ul.wrap li");if(ev.keyCode==39){ev.preventDefault();if(currentList.filter(".selected").nextAll(".boxg").eq(0).length>0){currentList.filter(".selected").nextAll(".boxg").eq(0).trigger("click");}}else{if(ev.keyCode==37){ev.preventDefault();if(currentList.filter(".selected").prevAll(".boxg").eq(0).length>0){currentList.filter(".selected").prevAll(".boxg").eq(0).trigger("click");}}}}});}function initTooltips(){$(".mop_CreditCard, .mop_DoubleCreditCard, .mop_TAMCreditCard").find(".wdk-tooltip").each(function(){$(this).qtip({content:{text:$(this).data("wdk-tooltip-content")},position:{my:"bottom center",at:"top center"},show:"click",hide:"unfocus"});});}function initBeforeUnload(){if(clientSideData["FLOW"]!=undefined&&clientSideData["FLOW"]!=null&&clientSideData["FLOW"]=="BOOKING"){$("#purf header:first span.logo a:first").click(function(){$.blockUI.defaults.isblocked=true;});window.onbeforeunload=function(e){if(!e){e=window.event;}if(!$.blockUI.defaults.isBlocked){e.cancelBubble=true;var str=clientMessages["PURF.text.WarningBeforeUnloadMessage"];e.returnValue=str;if(e.stopPropagation){e.stopPropagation();e.preventDefault();}return str;}};}if(typeof clientSideData["PREVIOUSLY_SELECTED_MOP"]!=="undefined"&&clientSideData["PREVIOUSLY_SELECTED_MOP"]!=null&&clientSideData["PREVIOUSLY_SELECTED_MOP"]=="DCC"){$("#mopsLeftPanel label[data-code='DCC'] input").click();if(typeof clientSideData.CUSTOMER_INFORMATION.BILLING_INFO!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.BILLING_INFO!=null&&clientSideData.CUSTOMER_INFORMATION.BILLING_INFO==true){if(typeof clientSideData.CUSTOMER_INFORMATION.COUNTRY_1!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.COUNTRY_1!=null){$("#purf_country_1").val(clientSideData.CUSTOMER_INFORMATION.COUNTRY_1).selectBox("refresh");}if(clientSideData.CUSTOMER_INFORMATION.DIFFERENT_BILLING&&typeof clientSideData.CUSTOMER_INFORMATION.COUNTRY_2!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.COUNTRY_2!=null){$("#purf_country_2").val(clientSideData.CUSTOMER_INFORMATION.COUNTRY_2).selectBox("refresh");$(".mop_DoubleCreditCard label[for=billing_adress]").click();toggle($(".mop_DoubleCreditCard label[for=billing_adress]"),$(".mop_DoubleCreditCard #billing_panel"));}}if(typeof clientSideData.CUSTOMER_INFORMATION.DOCID_INFO!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.DOCID_INFO!=null&&clientSideData.CUSTOMER_INFORMATION.DOCID_INFO==true){if(typeof clientSideData.CUSTOMER_INFORMATION.DOCID_DAY_1!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.DOCID_DAY_1!=null){$("#dcc_cpfBirthDay_1").val(clientSideData.CUSTOMER_INFORMATION.DOCID_DAY_1).selectBox("refresh");}if(typeof clientSideData.CUSTOMER_INFORMATION.DOCID_MONTH_1!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.DOCID_MONTH_1!=null){$("#dcc_cpfBirthMonth_1").val(clientSideData.CUSTOMER_INFORMATION.DOCID_MONTH_1).selectBox("refresh");}if(typeof clientSideData.CUSTOMER_INFORMATION.DOCID_YEAR_1!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.DOCID_YEAR_1!=null){$("#dcc_cpfBirthYear_1").val(clientSideData.CUSTOMER_INFORMATION.DOCID_YEAR_1).selectBox("refresh");}if(clientSideData.CUSTOMER_INFORMATION.DIFFERENT_DOCID){if(typeof clientSideData.CUSTOMER_INFORMATION.DOCID_DAY_2!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.DOCID_DAY_2!=null){$("#dcc_cpfBirthDay_2").val(clientSideData.CUSTOMER_INFORMATION.DOCID_DAY_2).selectBox("refresh");}if(typeof clientSideData.CUSTOMER_INFORMATION.DOCID_MONTH_2!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.DOCID_MONTH_2!=null){$("#dcc_cpfBirthMonth_2").val(clientSideData.CUSTOMER_INFORMATION.DOCID_MONTH_2).selectBox("refresh");}if(typeof clientSideData.CUSTOMER_INFORMATION.DOCID_YEAR_2!=="undefined"&&clientSideData.CUSTOMER_INFORMATION.DOCID_YEAR_2!=null){$("#dcc_cpfBirthYear_2").val(clientSideData.CUSTOMER_INFORMATION.DOCID_YEAR_2).selectBox("refresh");}$(".mop_DoubleCreditCard label[for=security_adress]").click();toggle($(".mop_DoubleCreditCard label[for=security_adress]"),$(".mop_DoubleCreditCard #security_panel"));}}}}function initDccPriceFormatter(){var inputBlur=$(".doubleCC input[name='firstCCAmount']");var secAmount=$(".doubleCC .secondCCAmount");var firstCCMinAmount=$(".doubleCC .firstCCMinAmount");var firstCCMaxAmount=$(".doubleCC .firstCCMaxAmount");var currentMinAmount=clientSideData.CC_MIN_SPLIT_VALUE;var amountForServices=clientSideData.SERVICES_SELECTED_TOTAL;var minAmountFromParam=clientSideData.CC_MIN_SPLIT_VALUE_FROM_PARAM;var chstAmount=0;var insAmount=0;inputBlur.data("amount",currentMinAmount);inputBlur.val(theUtils.formatPriceWithCurrency(currentMinAmount,rpModel.currencyCode));secAmount.html(theUtils.formatPriceWithCurrency(getCCAmount(2,currentMinAmount).toFixed(2),rpModel.currencyCode));inputBlur.on("blur",function(){var regExpr=new RegExp(/^(\d*\.?,?\d*)+$/g);if(regExpr.test(this.value)==false||this.value==""){$(this).val("0");}var theVal=$(this).val();var isDecimalAtSecond=false;var isDecimalAtLast=false;var theLength=theVal.length;if(theVal.charAt(theLength-3)=="."||theVal.charAt(theLength-3)==","){isDecimalAtSecond=true;}if(theVal.charAt(theLength-2)=="."||theVal.charAt(theLength-2)==","){isDecimalAtLast=true;}theVal=theVal.replace(/\./g,"");theVal=theVal.replace(/,/g,"");if(isDecimalAtSecond){theVal=theVal.substr(0,theVal.length-2)+"."+theVal.substr(theVal.length-2,theVal.length);}else{if(isDecimalAtLast){theVal=theVal.substr(0,theVal.length-1)+"."+theVal.substr(theVal.length-1,theVal.length);}}var amountFromInput=parseFloat(theVal);var amount=amountFromInput;var maxToPay=parseFloat(rpModel.totals.grandTotal.amount)-parseFloat(minAmountFromParam);var minToPay=parseFloat(chstAmount)+parseFloat(insAmount);if(parseFloat(currentMinAmount)>minToPay){minToPay=parseFloat(currentMinAmount);}if(parseFloat(amountFromInput)>=maxToPay){amount=maxToPay.toFixed(2);$(this).val(amount);}if(parseFloat(amountFromInput)<=minToPay){amount=minToPay.toFixed(2);$(this).val(amount);}if($(this).val()===""){$(this).val("0");}var finalAmount=parseFloat(amount);$(this).data("amount",finalAmount);$(this).val(theUtils.formatPriceWithCurrency(finalAmount,rpModel.currencyCode));secAmount.html(theUtils.formatPriceWithCurrency(getCCAmount(2,finalAmount).toFixed(2),rpModel.currencyCode));});inputBlur.on("focus",function(){$(this).val($(this).data("amount"));});$(document).bind("addInsurance",function(ev,params){var amount=params.amount;insAmount=amount;var insuranceAmountToAdd=!((parseFloat(inputBlur.data("amount"))-parseFloat(amountForServices)-parseFloat(chstAmount))>=amount);if(!insuranceAmountToAdd){if(parseFloat(inputBlur.data("amount"))>parseFloat(firstCCMinAmount.data("value"))){firstCCMinAmount.html(theUtils.formatPriceWithCurrency(parseFloat(amount)+parseFloat(chstAmount)+parseFloat(amountForServices),rpModel.currencyCode));firstCCMinAmount.data("value",parseFloat(amount)+parseFloat(chstAmount)+parseFloat(amountForServices));}secAmount.html(theUtils.formatPriceWithCurrency(getCCAmount(2,parseFloat(inputBlur.data("amount"))).toFixed(2),rpModel.currencyCode));firstCCMaxAmount.html(theUtils.formatPriceWithCurrency(parseFloat(rpModel.totals.grandTotal.amount)-parseFloat(minAmountFromParam),rpModel.currencyCode));}if(insuranceAmountToAdd){inputBlur.data("amount",parseFloat(chstAmount)+parseFloat(amount)+parseFloat(amountForServices));inputBlur.val(theUtils.formatPriceWithCurrency(parseFloat(chstAmount)+parseFloat(amount)+parseFloat(amountForServices),rpModel.currencyCode));$(".doubleCC input[name='PAYMENT_GROUP_1_LIST_PAYMENT_1_AMOUNT']").val(inputBlur.data("amount"));firstCCMinAmount.html(theUtils.formatPriceWithCurrency(parseFloat(amount)+parseFloat(chstAmount)+parseFloat(amountForServices),rpModel.currencyCode));firstCCMinAmount.data("value",parseFloat(amount)+parseFloat(chstAmount)+parseFloat(amountForServices));secAmount.html(theUtils.formatPriceWithCurrency(getCCAmount(2,parseFloat(inputBlur.data("amount"))).toFixed(2),rpModel.currencyCode));firstCCMaxAmount.html(theUtils.formatPriceWithCurrency(parseFloat(rpModel.totals.grandTotal.amount)-parseFloat(minAmountFromParam),rpModel.currencyCode));}});$(document).bind("removeInsurance",function(ev){if(inputBlur.data("amount")>parseFloat(rpModel.totals.grandTotal.amount)-parseFloat(minAmountFromParam)){inputBlur.data("amount",parseFloat(rpModel.totals.grandTotal.amount)-parseFloat(minAmountFromParam));inputBlur.val(theUtils.formatPriceWithCurrency(parseFloat(rpModel.totals.grandTotal.amount)-parseFloat(minAmountFromParam),rpModel.currencyCode));$(".doubleCC input[name='PAYMENT_GROUP_1_LIST_PAYMENT_1_AMOUNT']").val(inputBlur.data("amount"));}insAmount=0;secAmount.html(theUtils.formatPriceWithCurrency(getCCAmount(2,parseFloat(inputBlur.data("amount"))).toFixed(2),rpModel.currencyCode));if(parseFloat(chstAmount)>parseFloat(currentMinAmount)){firstCCMinAmount.html(theUtils.formatPriceWithCurrency(parseFloat(chstAmount),rpModel.currencyCode));firstCCMinAmount.data("value",parseFloat(chstAmount));}else{firstCCMinAmount.html(theUtils.formatPriceWithCurrency(parseFloat(currentMinAmount),rpModel.currencyCode));firstCCMinAmount.data("value",parseFloat(currentMinAmount));}firstCCMaxAmount.html(theUtils.formatPriceWithCurrency(parseFloat(rpModel.totals.grandTotal.amount)-parseFloat(minAmountFromParam),rpModel.currencyCode));});$(document).bind("updateSeatsAll",function(event,params){chstAmount=0;for(var i=0;i<params.length;i++){for(var j=0;i<params[i].seatsInfo.seats.length;j++){var current=params[i].seatsInfo.seats[j];chstAmount+=parseFloat(current.price);}}inputBlur.data("amount",parseFloat(chstAmount)+parseFloat(insAmount));inputBlur.val(theUtils.formatPriceWithCurrency(parseFloat(chstAmount)+parseFloat(insAmount),rpModel.currencyCode));$(".doubleCC input[name='PAYMENT_GROUP_1_LIST_PAYMENT_1_AMOUNT']").val(inputBlur.data("amount"));secAmount.html(theUtils.formatPriceWithCurrency(getCCAmount(2,parseFloat(chstAmount)+parseFloat(insAmount)).toFixed(2),rpModel.currencyCode));firstCCMinAmount.html(theUtils.formatPriceWithCurrency(parseFloat(chstAmount)+parseFloat(insAmount),rpModel.currencyCode));firstCCMinAmount.data("value",parseFloat(chstAmount)+parseFloat(insAmount));firstCCMaxAmount.html(theUtils.formatPriceWithCurrency(parseFloat(rpModel.totals.grandTotal.amount)-parseFloat(minAmountFromParam),rpModel.currencyCode));});$("[id^='eCreditLineMessage_']").hide();$("#eCreditLineId").change(function(){var index=$(this).val();$("[id^='eCreditLineMessage_']").hide();$("#eCreditLineMessage_"+index).show();});}return{init:function(WDS_IS_APS){initSb();initDccPriceFormatter();initListeners();preselectMop();prefillBillingInformation();initValidators();initKeyNavigation();initCountryPreselectionForBillingAddress();initStateField();initBeforeUnload();initTooltips();if(clientSideData.PAGE_CODE=="HOTD"){currentMop="CreditCard";$("#MOP_FORM_0 ul:first li:first").click();}if($("#cuilCuitDropDown").val()===""){$("#cuit_number").prop("disabled",true);}},getMockForms:function(){return mockForms;},setCurrentMop:function(_currentMop){currentMop=_currentMop;},initStateField:function(){return initStateField();}};}(window,jQuery));$(function(){payment.init(clientSideData.WDS_IS_APS);});